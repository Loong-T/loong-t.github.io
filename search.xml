<?xml version="1.0" encoding="utf-8"?>
<search> 
  
    
    <entry>
      <title>é€šè¿‡ FileProvider å…±äº«æ–‡ä»¶</title>
      <link href="/2018/05/26/%E9%80%9A%E8%BF%87%20FileProvider%20%E5%85%B1%E4%BA%AB%E6%96%87%E4%BB%B6/"/>
      <url>/2018/05/26/%E9%80%9A%E8%BF%87%20FileProvider%20%E5%85%B1%E4%BA%AB%E6%96%87%E4%BB%B6/</url>
      <content type="html"><![CDATA[<p>æœ€è¿‘ç¢°åˆ°ä¸€ä¸ªå¼‚å¸¸ï¼Œ<code>android.os.FileUriExposedException: file://*** exposed beyond app through Intent.getData()</code>ï¼Œäº†è§£äº†ä¸€ä¸‹ï¼ŒåŸæ¥æ˜¯ Android 7.0ï¼ˆapi level 24ï¼‰å¼€å§‹ï¼Œé€šè¿‡ URI ä¸å…¶ä»–åº”ç”¨å…±äº«æ–‡ä»¶è¦æ±‚ URI å¿…é¡»æ˜¯ <code>content://</code> å¼€å¤´çš„å½¢å¼ã€‚è€Œ <a href="https://developer.android.com/reference/android/support/v4/content/FileProvider" target="_blank" rel="noopener">FileProvider</a> æ˜¯ç”¨æ¥åšè¿™ä»¶äº‹æœ€ç®€ä¾¿çš„æ–¹æ³•ã€‚</p><a id="more"></a><h1 id="å£°æ˜-FileProvider"><a href="#å£°æ˜-FileProvider" class="headerlink" title="å£°æ˜ FileProvider"></a>å£°æ˜ FileProvider</h1><p><code>FileProvider</code> æ˜¯ <code>ContentProvider</code> çš„å­ç±»ï¼Œæ‰€ä»¥éœ€è¦åœ¨ <code>AndroidManifest.xml</code> ä¸­è¿›è¡Œå£°æ˜ã€‚</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">provider</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:name</span>=<span class="string">"android.support.v4.content.FileProvider"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:authorities</span>=<span class="string">"com.example.myapp.fileprovider"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:grantUriPermissions</span>=<span class="string">"true"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:exported</span>=<span class="string">"false"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta-data</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:name</span>=<span class="string">"android.support.FILE_PROVIDER_PATHS"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:resource</span>=<span class="string">"@xml/filepaths"</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">provider</span>&gt;</span></span><br></pre></td></tr></table></figure><p>å°† <code>android:grantUriPermissions</code> è®¾ä¸º <code>true</code> ä¼šå…è®¸å¾—åˆ°è®¿é—®è¿™ä¸ª <code>FileProvider</code> ä¸‹æ‰€æœ‰æ•°æ®çš„æƒé™ã€‚</p><p><code>meta-data</code> è¿™éƒ¨åˆ†å°†ä¼šåœ¨åé¢å†ç»†è¯´ï¼Œå…¶ä»–éƒ¨åˆ†éƒ½æ˜¯å¸¸è§„ <code>ContentProvider</code> çš„å†…å®¹ã€‚</p><h1 id="æŒ‡å®šå¯è®¿é—®çš„æ–‡ä»¶"><a href="#æŒ‡å®šå¯è®¿é—®çš„æ–‡ä»¶" class="headerlink" title="æŒ‡å®šå¯è®¿é—®çš„æ–‡ä»¶"></a>æŒ‡å®šå¯è®¿é—®çš„æ–‡ä»¶</h1><p>åœ¨ä¸Šé¢çš„éƒ¨åˆ†ä¸­ï¼Œ<code>meta-data</code> é‡ŒæŒ‡å®šäº†ä¸€ä¸ª xml çš„èµ„æºæ–‡ä»¶ï¼Œè¿™ä¸ªæ–‡ä»¶ä¾¿æ˜¯ç”¨æ¥æŒ‡å®šå¯ä»¥è¢«è®¿é—®åˆ°çš„æ–‡ä»¶çš„ã€‚</p><p>åœ¨èµ„æºæ–‡ä»¶å¤¹ä¸­åˆ›å»ºä¸€ä¸ª xml èµ„æºæ–‡ä»¶ï¼Œæ ¹å…ƒç´ å¦‚ä¸‹ï¼š</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">paths</span> <span class="attr">xmlns:android</span>=<span class="string">"http://schemas.android.com/apk/res/android"</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">paths</span>&gt;</span></span><br></pre></td></tr></table></figure><p><code>paths</code> å†…å¯ä»¥æ·»åŠ å¦‚ä¸‹çš„å…ƒç´ ï¼š</p><ul><li><code>&lt;files-path name=&quot;name&quot; path=&quot;path&quot; /&gt;</code>ï¼šä»£è¡¨åº”ç”¨å†…éƒ¨å­˜å‚¨çš„ <code>files/</code> ç›®å½•ï¼Œä¹Ÿå°±æ˜¯ <code>Context.getFilesDir()</code> æ–¹æ³•æ‰€å¾—åˆ°çš„ç›®å½•ã€‚</li><li><code>&lt;cache-path name=&quot;name&quot; path=&quot;path&quot; /&gt;</code>ï¼š<code>Context.getCacheDir()</code> æ–¹æ³•å¾—åˆ°çš„ç›®å½•ã€‚</li><li><code>&lt;external-path name=&quot;name&quot; path=&quot;path&quot; /&gt;</code>ï¼šå¤–éƒ¨å­˜å‚¨ç›®å½•ï¼Œä¸ <code>Environment.getExternalStorageDirectory()</code> æ–¹æ³•å¾—åˆ°çš„ç»“æœä¸€æ ·ã€‚</li><li><code>&lt;external-files-path name=&quot;name&quot; path=&quot;path&quot; /&gt;</code>ï¼šå¯¹åº” <code>Context.getExternalFilesDir(null)</code> æ–¹æ³•ã€‚</li><li><code>&lt;external-cache-path name=&quot;name&quot; path=&quot;path&quot; /&gt;</code>: å¯¹åº” <code>Context.getExternalCacheDir()</code> æ–¹æ³•ã€‚</li><li><code>&lt;external-media-path name=&quot;name&quot; path=&quot;path&quot; /&gt;</code>: å¯¹åº” <code>Context.getExternalMediaDirs()</code> æ–¹æ³•ã€‚</li></ul><p>ä»¥ä¸Šå…ƒç´ éƒ½æœ‰ <code>name</code> å’Œ <code>path</code> ä¸¤ä¸ªå±æ€§ã€‚</p><p>æˆ‘ä» <code>path</code> å±æ€§è¯´èµ·ã€‚<code>path</code> å³æ˜¯çœŸå®çš„å­ç›®å½•åœ°å€æ®µã€‚æ¯”å¦‚ <code>&lt;files-path  path=&quot;docs/&quot; /&gt;</code> å¯¹åº”çš„æ˜¯ <code>files/docs/</code> ç›®å½•ã€‚é‚£ä¹ˆï¼Œå¦‚æœä¸æƒ³è¦å­ç›®å½•ï¼Œè€Œæ˜¯å½“å‰ç›®å½•å‘¢ï¼Ÿç”¨ <code>.</code> å•Šï¼</p><p>è€Œ <code>name</code> å±æ€§åˆ™æ˜¯æä¾›ç»™å¤–éƒ¨åº”ç”¨çš„ä¸€ä¸ªè™šå‡çš„å­ç›®å½•åœ°å€æ®µï¼ˆåœ¨ content URI ä¸­ä½¿ç”¨ï¼‰ï¼Œä¸»è¦æ˜¯ä¸ºäº†å®‰å…¨è€ƒè™‘ã€‚</p><h1 id="ä¸º-File-ç”Ÿæˆ-Content-URI"><a href="#ä¸º-File-ç”Ÿæˆ-Content-URI" class="headerlink" title="ä¸º File ç”Ÿæˆ Content URI"></a>ä¸º File ç”Ÿæˆ Content URI</h1><p>ä½¿ç”¨ <code>FileProvider.getUriForFile()</code> æ–¹æ³•å°±å¯ä»¥ä¸ºåœ¨æŒ‡å®šç›®å½•é‡Œçš„æ–‡ä»¶ç”Ÿæˆ content URIã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">File imagePath = <span class="keyword">new</span> File(Context.getFilesDir(), <span class="string">"images"</span>);</span><br><span class="line">File newFile = <span class="keyword">new</span> File(imagePath, <span class="string">"default_image.jpg"</span>);</span><br><span class="line">Uri contentUri = FileProvider.getUriForFile(getContext(), <span class="string">"com.mydomain.fileprovider"</span>, newFile);</span><br></pre></td></tr></table></figure><p>ä¸Šé¢è¿™æ®µä»£ç ï¼Œå†åŠ ä¸Šå¦‚ä¸‹çš„èµ„æºæ–‡ä»¶ï¼š</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">paths</span> <span class="attr">xmlns:android</span>=<span class="string">"http://schemas.android.com/apk/res/android"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">files-path</span> <span class="attr">name</span>=<span class="string">"my_images"</span> <span class="attr">path</span>=<span class="string">"images/"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">paths</span>&gt;</span></span><br></pre></td></tr></table></figure><p>æœ€åå¾—åˆ°çš„ content URI ä¼šæ˜¯ï¼š<code>content://com.mydomain.fileprovider/my_images/default_image.jpg</code>ã€‚</p><p>å†å›å¤´æ¥çœ‹ä¸€ä¸‹ã€‚com.mydomain.fileprovider æ˜¯ ContentProvider æŒ‡å®šçš„ authorityï¼ŒåŒæ—¶ä¹Ÿæ˜¯ <code>getUriForFile()</code> æ–¹æ³•æ‰€éœ€çš„å‚æ•°ã€‚my_images æ˜¯ <code>files-path</code> å…ƒç´ çš„ <code>name</code> å±æ€§ï¼Œå°†ä¼šæ˜ å°„åˆ°çœŸå®ç›®å½• images/ï¼Œä¹Ÿå°±æ˜¯ <code>path</code> å±æ€§ã€‚</p><p>ğŸ™‚è¿™é‡Œï¼ŒAndroid åˆæœ‰äº†äº›å°æ®‹å¿µï¼Œåœ¨ç¼–å†™ä»£ç çš„æ—¶å€™æ— æ³•ä¿è¯èµ„æºæ–‡ä»¶çš„å­—ç¬¦ä¸²å’Œä»£ç ä¸­çš„å­—ç¬¦ä¸²æ˜¯ä¸€è‡´çš„ã€‚åªèƒ½ç­‰åˆ°è¿è¡Œæ—¶æ‰èƒ½çŸ¥é“ã€‚</p><h1 id="ä¸º-URI-è·å–ä¸´æ—¶è®¿é—®æƒé™"><a href="#ä¸º-URI-è·å–ä¸´æ—¶è®¿é—®æƒé™" class="headerlink" title="ä¸º URI è·å–ä¸´æ—¶è®¿é—®æƒé™"></a>ä¸º URI è·å–ä¸´æ—¶è®¿é—®æƒé™</h1><p>é€šè¿‡ä¸Šé¢çš„æ­¥éª¤ï¼Œæˆ‘ä»¬å·²å¾—åˆ°ä¸€ä¸ªåœ°å€æ­£ç¡®çš„ URIï¼Œä½†è¿™ä¸ª URI è¿˜ä¸èƒ½è¢«å…¶ä»–åº”ç”¨æ­£å¸¸ä½¿ç”¨ã€‚æœ‰ä¸¤ç§æ–¹å¼æ¥ç»™äºˆä¸´æ—¶æ€§çš„è¯»å†™æƒé™ã€‚</p><p>ç¬¬ä¸€æ˜¯ä½¿ç”¨ <code>Context.grantUriPermission()</code> æ–¹æ³•ã€‚è¿™ä¸ªæ–¹æ³•éœ€è¦æŒ‡å®šè¦åˆ†äº«åº”ç”¨çš„åŒ…åã€‚ç„¶åä¼ å…¥ <code>Intent.FLAG_GRANT_READ_URI_PERMISSION</code> å’Œ <code>Intent.FLAG_GRANT_WRITE_URI_PERMISSION</code> æ¥æŒ‡å®šè¦æˆäºˆçš„æƒé™ã€‚ç»™äºˆæƒé™ä¹‹åï¼Œå¯ä»¥ä½¿ç”¨ <code>Context.revokeUriPermission()</code> æ¥å–æ¶ˆï¼›æˆ–è€…ç­‰åˆ°æœºå™¨é‡å¯ä¹‹åï¼Œè¿™ä¸€æ¬¡çš„æˆæƒä¹Ÿä¼šå¤±æ•ˆã€‚</p><p>è¿™ä¸ªæ–¹æ³•éœ€è¦äº‹å…ˆè®¾ç½®åº”ç”¨çš„åŒ…åï¼Œå¹¶ä¸æ˜¯å¾ˆå®ç”¨ã€‚</p><p>ç¬¬äºŒä¸ªæ–¹æ³•ï¼šå¯ä»¥ä½¿ç”¨ <code>Intent.setFlags()</code> æ–¹æ³•è®¾ç½®ä¸Šé¢æåˆ°çš„ä¸¤ä¸ª flagï¼Œæ¥æˆäºˆè¯»å†™æƒé™ã€‚æ­¤æ—¶ï¼Œéœ€è¦å°†è¿™ä¸ª URI ç”¨ <code>Intent.setData()</code> æ¥å½“æˆæ•°æ®ä¼ é€’ã€‚ç”±äºæˆ‘ä»¬å¤šåŠæ˜¯ä½¿ç”¨ Intent æ¥ä¼ é€’ URI çš„ï¼Œæ‰€ä»¥è¿™ä¸ªæ–¹æ³•æ¯”è¾ƒå®ç”¨ã€‚</p><h1 id="å›é¡¾"><a href="#å›é¡¾" class="headerlink" title="å›é¡¾"></a>å›é¡¾</h1><p>å‡ºäºå®‰å…¨è€ƒè™‘ï¼Œ7.0 å¼•å…¥äº†è¿™ä¸ªæœºåˆ¶ã€‚ä¸€æ¥å¯ä»¥é¿å…æš´éœ²åº”ç”¨å†…éƒ¨çš„æ–‡ä»¶ç³»ç»Ÿä¿¡æ¯ï¼ŒäºŒæ¥ä¸è¦æ±‚æ–‡ä»¶æ•°æ®æ¥æ”¶æ–¹æ‹¥æœ‰ <code>READ_EXTERNAL_STORAGE</code> æƒé™ã€‚å‡ºå‘ç‚¹æ˜¯å¥½çš„ï¼Œåœ¨å®ç°ä¸Šç•¥æœ‰ç‘•ç–µï¼Œæ€»ä½“æ„Ÿè§‰è¿˜ä¸é”™ï¼Œå»ºè®®ä½¿ç”¨ã€‚</p>]]></content>
      
      
        <tags>
            
            <tag> Android </tag>
            
            <tag> FileProvider </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>åˆ†äº«ä¸¤ä¸ªé¢œè‰²èµ„æºæ–‡ä»¶</title>
      <link href="/2017/07/17/%E5%88%86%E4%BA%AB%E4%B8%A4%E4%B8%AA%E9%A2%9C%E8%89%B2%E8%B5%84%E6%BA%90%E6%96%87%E4%BB%B6/"/>
      <url>/2017/07/17/%E5%88%86%E4%BA%AB%E4%B8%A4%E4%B8%AA%E9%A2%9C%E8%89%B2%E8%B5%84%E6%BA%90%E6%96%87%E4%BB%B6/</url>
      <content type="html"><![CDATA[<p>å½“åˆçœ‹åˆ° Material Design é‚£ä¸ª 48 ç§’çš„<a href="https://www.youtube.com/watch?v=Q8TXgCzxEnw" target="_blank" rel="external">è§†é¢‘</a>çš„æ—¶å€™ï¼Œæˆ‘å¿ƒé‡Œå°±æœ‰å£°éŸ³åœ¨å¤§å–Šï¼šâ€œå°±æ˜¯è¿™ä¸ªï¼æˆ‘æƒ³è¦çš„å°±æ˜¯è¿™ç§è®¾è®¡ï¼â€</p><p>è¿„ä»Šå·²æœ‰ä¸‰å¹´å¤šï¼ŒMD å¾—åˆ°äº†ä¸é”™çš„æ¨å¹¿ã€‚ç„¶è€Œèƒ½è®©æˆ‘çœ¼å‰ä¸€äº®çš„è®¾è®¡å´æ˜¯å¯¥å¯¥ã€‚å¤§é‡çš„åº”ç”¨çº¯ç²¹å¥—äº†ä¸€ä¸ª MD çš„çš®ï¼Œç”¨ç€æä¾›çš„æ ‡å‡†æ§ä»¶ï¼Œä½†æ²¡æœ‰æ›´ä¸ºæ·±å…¥åœ°å»è®¾è®¡ï¼Œæ˜¾å¾—éå¸¸æ¯ç‡¥å¹²ç˜ªã€‚è¿™ç§æ—¶å€™ MD åè€Œæˆäº†ç´¯èµ˜ã€‚</p><a id="more"></a><p>ç»†çœ‹ Android ä¸Šçš„ MDï¼Œç”±äº Android çš„ç³»ç»Ÿç‰ˆæœ¬é™åˆ¶ï¼Œä¸ºäº†ç…§é¡¾ 4.X çš„ç”¨æˆ·ï¼Œé€šå¸¸ä¸ä¼šè¿‡å¤šä½¿ç”¨ 5.0 æ‰æœ‰çš„åŠŸèƒ½ï¼Œæ¯”å¦‚è½¬åœºåŠ¨ç”»ã€é˜´å½±ã€‚ä½†æƒ³è¦åšå‡ºå¥½çœ‹çš„è®¾è®¡ï¼ŒåŠ¨ç”»ä¸é˜´å½±ä¸å¯å°‘ã€‚è§†é¢‘å±•ç¤ºçš„å†…å®¹ï¼Œå¯ä»¥è¯´æ˜¯æ²¡æœ‰ä¸€ç§’è„±ç¦»è¿™ä¸¤ä¸ªè¦ç´ ã€‚</p><p>åŠ¨ç”»å®ç°ä¸æ˜“ï¼Œä¸”æ”¾ä¸€è¾¹ã€‚è€Œé˜´å½±å€’æ˜¯å®¹æ˜“ä¸å°‘ï¼Œå¸Œæœ›èƒ½å¤šå¤šåŠ ä¸Šã€‚æ²¡æœ‰é˜´å½±çš„è¾…åŠ©ï¼Œåº”ç”¨ä¼šçœ‹èµ·æ¥æ²¡æœ‰å±‚æ¬¡æ„Ÿã€‚ä½†åˆä¼šçœ‹åˆ°ä¸å°‘æ»¥ç”¨ card çš„æƒ…å†µï¼Œä¹Ÿæ˜¯å¿ƒç´¯ã€‚</p><p>è€Œå¤§éƒ¨åˆ†ä½¿ç”¨äº† Material Design çš„åº”ç”¨çœ‹èµ·æ¥éƒ½å¤§åŒå°å¼‚çš„åŸå› ï¼Œå¤§æ¦‚å°±æ˜¯é¢œè‰²äº†ã€‚å®˜æ–¹æä¾›äº†ä¸€ä¸ª color paletteï¼Œç®—æ˜¯æ ‡å‡†é¢œè‰²åº“ã€‚é¢œè‰²æ•°é‡ä¸å°‘ï¼Œä½†æ¨èæ‹¿æ¥å½“ä¸»è‰²è°ƒçš„ï¼Œåªæœ‰ 500 ç³»åˆ—ã€‚é‚£æ˜¯å¤šå°‘ç§å‘¢ï¼Ÿ19 ç§ï¼ˆè¿˜æœ‰é»‘ç™½ä¸¤è‰²æ²¡æœ‰ç®—å…¥ï¼‰ã€‚äº‹å®ä¸Šä¼šæ‹¿æ¥ç”¨çš„ï¼Œä¸è¿‡é‚£äº›çœ‹èµ·æ¥èˆ’æœçš„é¢œè‰²ï¼šè“ã€ç»¿ã€ç°ç­‰ï¼Œå¯é€‰çš„é¢œè‰²å¯è°“å°‘ä¹‹åˆå°‘ã€‚åœ¨è¿™ä¹‹å¤–è¿˜è¦å†é€‰å–ä¸€ç§ accent colorï¼Œè¿˜è¦ä¸ä¸»è‰²è°ƒå½¢æˆä¸€å®šçš„å¯¹æ¯”ï¼Œå½“ç„¶ï¼Œä¹Ÿä¸èƒ½å¤ªççœ¼ã€‚æ‰€ä»¥èƒ½ç”¨çš„é¢œè‰²ç»„åˆå¹¶ä¸å¤šï¼Œä½ èƒ½çœ‹åˆ°çš„ï¼Œå¤§æ¦‚å¤§éƒ¨åˆ†éƒ½æ˜¯ç»¿è‰²ã€è“ç°è‰²ã€è“è‰²çš„å§ã€‚è¿™æ ·æ€ä¹ˆä¼šä¸æ¯ç‡¥å‘¢ï¼Ÿ</p><p>æˆ‘ä¸ªäººå¾ˆå–œæ¬¢ MD çš„åŠ¨æ•ˆå’Œé˜´å½±ï¼Œè¿˜æœ‰è·Ÿå›¾ç‰‡çš„å·§å¦™æ­é…ã€‚ä½†å¯¹äºå®˜æ–¹æ¨èçš„é¢œè‰²ï¼Œæˆ‘å¹¶ä¸æ˜¯å¾ˆè®¤åŒã€‚å¦‚æœæ˜¯ç”¨åœ¨æ§ä»¶ä¸Šçš„ã€å°‘é‡è£…é¥°æ€§çš„é¢œè‰²ï¼Œæˆ‘ä¼šç›´æ¥åœ¨å®˜æ–¹çš„ color palette ä¸­æŒ‘é€‰ã€‚ä½†å¦‚æœè¦å†³å®šä¸€ä¸ªåº”ç”¨çš„ä¸»è‰²è°ƒï¼Œæˆ‘ä¼šå°½é‡é¿å…ä½¿ç”¨ã€‚</p><p>ç»ˆäºè¦æåˆ°æœ¬æ–‡çš„ä¸»é¢˜äº†ï¼Œå°±æ˜¯æˆ‘æƒ³è¦åˆ†äº«çš„ä¸¤ä¸ªé¢œè‰²èµ„æºã€‚ä¸€ä¸ªæ¥è‡ª<a href="http://nipponcolors.com/" target="_blank" rel="external">æ—¥æœ¬ã®ä¼çµ±è‰²</a>ï¼Œæˆ‘å°†é‡Œé¢çš„é¢œè‰²æå–æˆ Android çš„èµ„æºæ–‡ä»¶ï¼Œå¹¶ä¸”æ”¾åœ¨äº† Gist ä¸Šã€‚ä½ å¯ä»¥åœ¨<a href="https://gist.github.com/Loong-T/ba3953685a2f3d32225468374ca3056f" target="_blank" rel="external">è¿™é‡Œ</a>æ‰¾åˆ°ã€‚ç½‘ç«™æœ¬èº«ä¹Ÿå¾ˆå¥½çœ‹ï¼Œå¯ä»¥å»è§‚æ‘©ä¸‹ã€‚è¿™äº›é¢œè‰²æˆ‘è§‰å¾—å¯¹çœ¼ç›å¾ˆå‹å¥½ï¼Œçœ‹èµ·æ¥éƒ½æŒºèˆ’æœã€‚å¦ä¸€ä¸ªæ¥è‡ª<a href="http://boxingp.github.io/traditional-chinese-colors/" target="_blank" rel="external">ä¸­å›½ä¼ ç»Ÿé¢œè‰²</a>ï¼Œæˆ‘è‡ªå·±æ²¡æœ‰ç”¨è¿‡å¾ˆå¤šï¼Œä¸çŸ¥é“æ•ˆæœå¦‚ä½•ï¼Œç®—æ˜¯é™„èµ å§ã€‚ä½ å¯ä»¥åœ¨<a href="https://gist.github.com/Loong-T/e204a3326bea1bccbdd4c581a1d1909f" target="_blank" rel="external">è¿™é‡Œ</a>è®¿é—®åˆ°ã€‚</p>]]></content>
      
      
        <tags>
            
            <tag> Android </tag>
            
            <tag> Resource </tag>
            
            <tag> Color </tag>
            
            <tag> Design </tag>
            
            <tag> Material Design </tag>
            
            <tag> åˆ†äº« </tag>
            
            <tag> èµ„æº </tag>
            
            <tag> é¢œè‰² </tag>
            
            <tag> è®¾è®¡ </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>ZXing Android Embedded çš„ä½¿ç”¨ä»¥åŠè‡ªå®šä¹‰å¸ƒå±€</title>
      <link href="/2017/07/16/ZXing-Android-Embedded-%E7%9A%84%E4%BD%BF%E7%94%A8%E4%BB%A5%E5%8F%8A%E8%87%AA%E5%AE%9A%E4%B9%89%E5%B8%83%E5%B1%80/"/>
      <url>/2017/07/16/ZXing-Android-Embedded-%E7%9A%84%E4%BD%BF%E7%94%A8%E4%BB%A5%E5%8F%8A%E8%87%AA%E5%AE%9A%E4%B9%89%E5%B8%83%E5%B1%80/</url>
      <content type="html"><![CDATA[<p>æƒ³åšä¸ªæ‰«ææ¡å½¢ç çš„åŠŸèƒ½ï¼Œç¬¬ä¸€æƒ³åˆ°çš„å°±æ˜¯ <a href="https://github.com/zxing/zxing/" target="_blank" rel="noopener">ZXing</a> äº†ã€‚ZXing çš„åŠŸèƒ½å¾ˆå¼ºå¤§ï¼Œé€šå¸¸ä¸éœ€è¦å®Œæ•´æŠŠæ•´ä¸ªåº“éƒ½ä½œä¸ºä¾èµ–æ”¾è¿›åº”ç”¨é‡Œï¼Œè€Œæ˜¯åˆ†ç¦»å‡ºåŠŸèƒ½æ‰€éœ€è¦çš„ä¸€éƒ¨åˆ†ã€‚è¿™ç±»çš„æ–‡ç« ã€åº“è¿˜æŒºå¤šçš„ï¼Œè¿™æ¬¡çœ‹ä¸Šçš„æ˜¯ <a href="https://github.com/journeyapps/zxing-android-embedded" target="_blank" rel="noopener">ZXing Android Embedded</a>ï¼Œå¤§ä½“ä¸Šæ»¡è¶³äº†æˆ‘çš„éœ€è¦ã€‚ç„¶è€Œè¿™ä¸ªåº“ä¹Ÿç®—æ˜¯ç»§æ‰¿äº† ZXing çš„ä¼ ç»Ÿï¼Œæ–‡æ¡£ä¸å…¨é¢ã€‚è¿™é‡Œç¨å¾®å†™ä¸€ä¸‹ä½¿ç”¨çš„æ–¹æ³•ï¼Œå¹¶ä¸”å¯¹ ViewfinderView çš„å¸ƒå±€è¿›è¡Œä¸€å®šçš„æ”¹è¿›ã€‚</p><a id="more"></a><h2 id="å…³é”®-View-çš„ä»‹ç»"><a href="#å…³é”®-View-çš„ä»‹ç»" class="headerlink" title="å…³é”® View çš„ä»‹ç»"></a>å…³é”® View çš„ä»‹ç»</h2><p>æ•æˆ‘ä¸å†ä»‹ç» <code>IntentIntegrator</code> æˆ–è€…æ˜¯ <code>DecoratedBarcodeView</code> çš„ç”¨æ³•ï¼Œè¿™å¯ä»¥åœ¨æ–‡æ¡£å’Œç¤ºä¾‹ä¸­æ‰¾åˆ°ç”¨æ³•ã€‚</p><p><img src="/uploads/blog_pics/zxing-android-embadded-pic-1.png" alt="ZXing android embedded pic"></p><p>æ­é…å®˜æ–¹ç¤ºä¾‹çš„å›¾æ¥ä»‹ç»ä¸‹å‡ ä¸ªæ¯”è¾ƒå…³é”®çš„ Viewã€‚äº‹å®ä¸Šå¹¶æ²¡æœ‰ä»€ä¹ˆéš¾ç‚¹ï¼Œä½†å› ä¸ºæ–‡æ¡£ä¸å…¨é¢ï¼Œéœ€è¦è¯•è¿‡æ‰èƒ½å®é™…çŸ¥é“ç›¸å…³çš„å†…å®¹ã€‚</p><p>å›¾ä¸­çš„å†…å®¹å¾ˆç®€å•ï¼Œå°±æ˜¯ä¸€ä¸ª DecoratedBarcodeViewï¼Œè€Œè¿™ä¸ª View å®é™…ä¸Šæ˜¯ç”± BarcodeViewã€ViewfinderView å’Œä¸€ä¸ª TextView ç»„åˆè€Œæˆçš„ã€‚TextView æ˜¾ç¤ºäº†åº•éƒ¨çš„æ–‡å­—ã€‚ViewfinderView ç»˜åˆ¶äº†å‘¨è¾¹åŠé€æ˜çš„é»‘è‰²é®ç½©ï¼Œä¸­é—´çš„çº¢çº¿ï¼Œæ‰«ææ—¶å‡ºç°çš„é»„ç‚¹ï¼Œä»¥åŠæ‰«ææˆåŠŸåçš„ç»“æœã€‚BarcodeView è´Ÿè´£è°ƒç”¨ç›¸æœºè¿›è¡Œæ‰«æï¼Œå¹¶ä¸”ä¹Ÿè´Ÿè´£ç»˜åˆ¶ç›¸æœºæ‹åˆ°çš„å†…å®¹ï¼Œä¹Ÿå°±æ˜¯è¢« ViewfinderView è¦†ç›–åœ¨ä¸‹é¢çš„å†…å®¹ã€‚</p><p>å‡å¦‚ï¼Œä½ æƒ³è¦çš„åŠŸèƒ½åªæ˜¯å•çº¯åœ°æ‰«æï¼Œä½ åªéœ€è¦ BarcodeViewã€‚é‚£ä¹ˆæ¥çœ‹çœ‹ BarcodeView æ€ä¹ˆä½¿ç”¨ã€‚</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">com.journeyapps.barcodescanner.BarcodeView</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:id</span>=<span class="string">"@+id/zxing_barcode_surface"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:layout_height</span>=<span class="string">"match_parent"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">app:zxing_framing_rect_width</span>=<span class="string">"220dp"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">app:zxing_framing_rect_height</span>=<span class="string">"220dp"</span>/&gt;</span></span><br></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°æœ‰ä¸¤ä¸ªè‡ªå®šä¹‰çš„å±æ€§ï¼ŒæŒ‡å®šäº†æ‰«æåŒºåŸŸçš„å¤§å°ã€‚è¿™ä¸ªæ‰«æåŒºåŸŸï¼Œå°±æ˜¯ä¸Šå›¾ä¸­ï¼Œæ²¡æœ‰è¢«åŠé€æ˜é®ç½©ç›–ä½çš„éƒ¨åˆ†ã€‚å‰é¢ä¹Ÿè¯´äº†ï¼Œé»‘è‰²é®ç½©å®é™…ä¸Šæ˜¯ç”± ViewfinderView ç»˜åˆ¶çš„ã€‚æ‰€ä»¥åœ¨å•ç”¨ BarcodeView æ—¶ï¼Œæ˜¯â€œçœ‹â€ä¸å‡ºæ¥è¿™ä¸¤ä¸ªå±æ€§çš„ä½œç”¨çš„ã€‚ä½†æœ‰å®é™…çš„æ•ˆæœï¼Œæ¯”å¦‚ä¼šå½±å“åˆ°å¯èƒ½çš„ç‚¹çš„åæ ‡ã€æ‰«æç»“æœå¾—åˆ°çš„ Bitmapã€‚</p><p>è¿›è¡Œæ‰«æä¹Ÿå¾ˆç®€å•ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">barcodeView.decodeSingle(<span class="keyword">new</span> BarcodeCallback() &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">barcodeResult</span><span class="params">(BarcodeResult result)</span> </span>&#123;</span><br><span class="line">        textView.setText(<span class="string">"Scan result: "</span> + result.getText());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">possibleResultPoints</span><span class="params">(List&lt;ResultPoint&gt; resultPoints)</span> </span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p>ä¸Šé¢çš„ä»£ç å°±è¿›è¡Œäº†å•æ¬¡çš„æ‰«æï¼Œ<code>barcodeResult</code> æ–¹æ³•å°†ä¼šåœ¨æ‰«ææˆåŠŸåè¢«è°ƒç”¨ï¼Œå¾—åˆ°æ‰«æçš„ç»“æœã€‚BarcodeResult æ¯”è¾ƒå¸¸ç”¨çš„æ˜¯ <code>getText()</code> å’Œ <code>getBitmap()</code>ï¼Œåˆ†åˆ«è·å–æ‰«æçš„æ–‡å­—ç»“æœä»¥åŠæ‰«ææˆåŠŸæ—¶çš„å›¾åƒã€‚é™¤äº†å•æ¬¡æ‰«æï¼Œè¿˜æœ‰ <code>decodeContinuous(BarcodeCallback)</code> æ–¹æ³•ï¼Œå¯ä»¥è¿ç»­æ‰«æå¤šæ¬¡ï¼Œä½¿ç”¨ä¸Šå¤§åŒå°å¼‚ã€‚</p><p><code>possibleResultPoints()</code> æ–¹æ³•å°†ä¼šä¼ é€’ä¸€äº›è·Ÿæ‰«ææœ‰å…³çš„ç‚¹çš„ä¿¡æ¯ï¼Œé€šå¸¸æ˜¯ç»™ ViewfinderView ä½¿ç”¨çš„ã€‚åœ¨ä¸Šå›¾ä¸­æœ‰ä¸€ä¸ªå°é»„ç‚¹ï¼Œä¹Ÿå°±æ˜¯è¿™ä¸ªæ–¹æ³•é‡Œå¾—åˆ°çš„ã€‚</p><p>é™¤äº†ä¸Šé¢æåˆ°çš„æ–¹æ³•å¤–ï¼ŒBarcodeView è¿˜æœ‰ <code>pause()</code> å’Œ <code>resume()</code> æ–¹æ³•ã€‚è§åˆ°è¿™ä¸ªåå­—å¤§æ¦‚å°±æ˜ç™½ä»€ä¹ˆä½œç”¨äº†ã€‚ç”±äº BarcodeView ä½¿ç”¨äº†ç›¸æœºï¼Œå¹¶ä¸”è§£æå·¥ä½œä¹Ÿæœ‰ç›¸å½“çš„è®¡ç®—é‡ï¼Œæ‰€ä»¥åœ¨ç”Ÿå‘½å‘¨æœŸä¸­éœ€è¦è°ƒç”¨è¿™ä¸¤ä¸ªæ–¹æ³•ã€‚ä»è§†è§‰çš„æ•ˆæœä¸Šæ¥è¯´ï¼Œ<code>pause()</code> æ–¹æ³•å°†ä¼šåœæ­¢æ•´ä¸ª view å¯¹äºç›¸æœºæ‹æ‘„å†…å®¹çš„ä¸æ–­é‡ç»˜ï¼Œæ‰€ä»¥å½“ä½ è§‰å¾—éœ€è¦å›ºå®š BarcodeView æ˜¾ç¤ºçš„å†…å®¹æ—¶ï¼Œä¹Ÿå¯ä»¥è°ƒç”¨è¿™ä¸ªæ–¹æ³•ã€‚</p><p>ç„¶åå¼ºè°ƒä¸€ä¸‹ï¼š<strong>ä½¿ç”¨ BarcodeView å‰ï¼Œè®°å¾—è¯·æ±‚ç›¸æœºæƒé™</strong>ã€‚</p><p>å†æ¥è¯´è¯´ ViewfinderViewã€‚ViewfinderView æœ¬èº«æ²¡å•¥åŠŸèƒ½ï¼Œä¸»è¦æä¾› UI ä¸Šçš„è¾…åŠ©ï¼Œç»™ç”¨æˆ·ç•™ä¸‹â€œæˆ‘æœ‰åœ¨å¥½å¥½æ‰«æå•¦â€çš„å°è±¡ã€‚èƒ½å¤Ÿè‡ªå®šä¹‰é®ç½©ã€å¯èƒ½ç‚¹ã€æ¨ªçº¿çš„é¢œè‰²ã€‚é€šè¿‡ <code>setCamearaView()</code> æ–¹æ³•å…³è” BarcodeViewï¼Œä½¿å¾— ViewfinderView èƒ½å¤Ÿè·å–åˆ°æ‰«æåŒºåŸŸçš„å¤§å°ã€‚</p><p><code>drawResultBitmap()</code> æ–¹æ³•å¯ä»¥å°†æŒ‡å®šçš„ Bitmap ç»˜åˆ¶åœ¨éé®ç½©çš„åŒºåŸŸï¼Œæœ‰ä¸€ä¸ªåŠé€æ˜çš„æ•ˆæœï¼Œå¹¶ä¸”åœæ­¢æ¨ªçº¿å’Œç‚¹çš„ç»˜åˆ¶ã€‚é€šå¸¸é…åˆ BarcodeResult ä½¿ç”¨ã€‚ä¸ä¹‹å¯¹åº”çš„ï¼Œè¿˜æœ‰ä¸€ä¸ª <code>drawViewfinder()</code> æ–¹æ³•ï¼šæ¸…é™¤æ‰ Bitmap é‡æ–°å¼€å§‹ç”»è·³åŠ¨çš„æ¨ªçº¿ã€‚</p><h2 id="è¿˜æœ‰ä»€ä¹ˆï¼Ÿ"><a href="#è¿˜æœ‰ä»€ä¹ˆï¼Ÿ" class="headerlink" title="è¿˜æœ‰ä»€ä¹ˆï¼Ÿ"></a>è¿˜æœ‰ä»€ä¹ˆï¼Ÿ</h2><p>è¯´çœŸçš„ï¼Œä½¿ç”¨ ZXing Android Embedded æ¥å°†æ‰«æåŠŸèƒ½é›†æˆåˆ°åº”ç”¨é‡Œå¯è¯´æ˜¯éå¸¸å®¹æ˜“ã€‚ä½†æ˜¯â€”â€”ä½†æ˜¯ï¼Œæƒ³è¦è¿›è¡Œè‡ªå®šä¹‰çš„å¸ƒå±€å´æ˜¯ç›¸å½“å›°éš¾ã€‚</p><p>è®°å¾—å‰é¢æåˆ°çš„ BarcodeView çš„æ‰«æåŒºåŸŸå—ï¼Ÿæˆ‘ä»¬çœ‹ä¸åˆ°ï¼Œä½†å®ƒå®é™…å­˜åœ¨ç€å¹¶ä¸”å‘æŒ¥ç€ä½œç”¨ã€‚æˆ‘ä»¬èƒ½å¤ŸæŒ‡å®šå®ƒçš„å¤§å°ï¼Œä½†æ˜¯ï¼Œæˆ‘ä»¬ä¸èƒ½æŒ‡å®šå®ƒçš„ä½ç½®ã€‚è¿™ä¸ªæ‰«æåŒºåŸŸæ°¸è¿œæ˜¯åœ¨ BarcodeView çš„æ­£ä¸­é—´çš„ï¼</p><p>è™½ç„¶ BarcodeView çš„æ‰«æåŒºåŸŸæ˜¯çœ‹ä¸è§çš„ï¼Œä½† ViewfinderView çš„éé®ç½©åŒºåŸŸå´æ˜¯å®é™…å¯è§çš„ã€‚å‡å¦‚æƒ³è¦æŠŠè¿™ä¸ªåŒºåŸŸç§»åŠ¨ä¸€ä¸‹ä½ç½®ï¼Œè¯¥æ€ä¹ˆåŠï¼Ÿ</p><p>æˆ‘é¼“æ£äº†ä¸€é˜µå­ï¼Œé‡æ–°å†™äº†ä¸ª ViewfinderViewï¼Œæ€»ä½“æ¥è¯´èƒ½å¤Ÿæ»¡è¶³æˆ‘ä¸ªäººçš„å¸ƒå±€è¦æ±‚äº†ã€‚ä½†è¿˜æœ‰æ¯”è¾ƒæ˜æ˜¾çš„ç¼ºé™·ï¼Œå› ä¸ºæ²¡æœ‰ä¿®æ”¹ CameraViewï¼Œæ‰€ä»¥å¯¹æ‰«æåŒºåŸŸå®é™…ä¸Šæ²¡æœ‰æ”¹åŠ¨ã€‚å¯¼è‡´å¾—åˆ°çš„æ‰«æç»“æœï¼Œè·Ÿç”»é¢ä¸Šçš„åŒºåŸŸä¼šä¸ä¸€è‡´ã€‚å¦‚æœä¸ä½¿ç”¨ <code>drawResultBitmap()</code> æ–¹æ³•çš„è¯ï¼Œæ˜¾ç¤ºä¸Šå°±æ²¡æœ‰å¤ªå¤§çš„é—®é¢˜ã€‚å¦‚æœè‡ªå®šä¹‰çš„åŒºåŸŸåç¦»ä¸­å¿ƒåŒºåŸŸå¤ªè¿œçš„è¯ï¼Œä¸å»ºè®®ä½¿ç”¨ï¼Œå› ä¸ºå¯èƒ½ä¼šå‡ºç°æ‰«æä¸å‡†çš„æƒ…å†µã€‚ç”±äºæ—¶é—´ä¸Šä¸å…è®¸ï¼Œæš‚æ—¶åªèƒ½åšå‡ºè¿™æ ·çš„å¦¥åï¼Œåªèƒ½å°†æ¥æœ‰æœºä¼šçš„æ—¶å€™å†æ›´æ·±å…¥å®šåˆ¶äº†ã€‚é‚£æ ·çš„è¯ï¼Œè¯´ä¸å®šç›´æ¥åœ¨ ZXing çš„åŸºç¡€ä¸Šè¿›è¡Œä¿®æ”¹è¿˜æ›´æ–¹ä¾¿ã€‚</p><p>æ·»åŠ äº† <code>vfv_frameGravity</code> çš„å±æ€§ï¼Œå¯ä»¥æŒ‡å®šéé®ç½©åŒºåŸŸï¼ˆä¹Ÿå°±æ˜¯è§†è§‰ä¸Šçš„æ‰«æåŒºåŸŸï¼‰çš„ä½ç½®ï¼Œæœ‰ centerã€centerHorizontal å’Œ centerVertical ä¸‰ä¸ªå€¼å¯é€‰ã€‚åŒæ—¶å°† paddingTop å’Œ paddingLeft åŠ å…¥åˆ°å¸ƒå±€çš„è®¡ç®—ä¸­ã€‚è¿™ä¸¤è€…ä¹‹é—´ï¼ŒframeGravity ä¼˜å…ˆäº paddingã€‚</p><p><img src="/uploads/blog_pics/configrable-viewfinderview-pic.png" alt="configrable viewfinderview pic"></p><p>ä¸¾ä¾‹æ¥è¯´ï¼Œä¸Šå›¾çš„æ•ˆæœè®¾ç½®äº† centerHorizontal è¿›è¡Œæ°´å¹³å±…ä¸­ï¼Œæ­¤æ—¶å¦‚æœå†è®¾ç½® paddingLeft æ˜¯ä¸ä¼šèµ·ä½œç”¨çš„ã€‚åœ¨å‚ç›´æ–¹å‘ä¸Šï¼Œæ˜¯é€šè¿‡ paddingTop è®¾ç½®äº† 110dpã€‚</p><p>æˆ‘é‡å†™çš„ ViewfinderView é¡¹ç›®åœ¨[è¿™å„¿][configurable-viewfindderview]ï¼Œé‡Œé¢é™„å¸¦äº†ç¤ºä¾‹ã€‚å¯ä»¥é€šè¿‡ <a href="https://jitpack.io/" target="_blank" rel="noopener">Jitpack</a> æ¥ä½¿ç”¨ï¼š</p><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">allprojects &#123;</span><br><span class="line">    repositories &#123;</span><br><span class="line">        ...</span><br><span class="line">        maven &#123; url <span class="string">'https://jitpack.io'</span> &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">compile <span class="string">'com.github.loong-t:configurable-viewfinderview:1.0.0'</span></span><br></pre></td></tr></table></figure><p>ç°åœ¨å¯¹è¿™ä¸ª View çš„åŠŸèƒ½è¿˜ä¸æ˜¯å¾ˆæ»¡æ„ï¼Œåªèƒ½æ˜¯ä¾›å‚è€ƒçš„ç¨‹åº¦ã€‚</p>]]></content>
      
      
        <tags>
            
            <tag> Android </tag>
            
            <tag> ZXing </tag>
            
            <tag> æ‰«ç  </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>dagger.androidâ€”â€”Android ä¸­ä½¿ç”¨ Dagger2 çš„æ–°æ–¹æ³•</title>
      <link href="/2017/07/09/dagger-android%E2%80%94%E2%80%94Android-%E4%B8%AD%E4%BD%BF%E7%94%A8-Dagger2-%E7%9A%84%E6%96%B0%E6%96%B9%E6%B3%95/"/>
      <url>/2017/07/09/dagger-android%E2%80%94%E2%80%94Android-%E4%B8%AD%E4%BD%BF%E7%94%A8-Dagger2-%E7%9A%84%E6%96%B0%E6%96%B9%E6%B3%95/</url>
      <content type="html"><![CDATA[<p>ä¸æ‰“ç®—è®²è§£ Dagger2 çš„åŸºç¡€çŸ¥è¯†ã€‚</p><p>åŸå…ˆåœ¨ Android é¡¹ç›®ä¸­ä½¿ç”¨ Dagger2ï¼Œå‡†å¤‡å¥½äº† Component å’Œ Module ä¹‹åï¼Œåœ¨ Activity æˆ–è€… Fragment é‡Œå¤§æ¦‚æ˜¯è¿™ä¹ˆä½¿ç”¨çš„ï¼š</p><a id="more"></a><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// AppComponent</span></span><br><span class="line"><span class="meta">@Singleton</span></span><br><span class="line"><span class="meta">@Component</span>(modules = &#123;</span><br><span class="line">        AppModule.class,</span><br><span class="line">&#125;)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">AppComponent</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    MainActivityComponent.<span class="function">Builder <span class="title">mainComponentBuilder</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">inject</span><span class="params">(ThisApplication application)</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// MainActivityComponent</span></span><br><span class="line"><span class="meta">@ActivityScope</span></span><br><span class="line"><span class="meta">@Subcomponent</span>(modules = &#123;</span><br><span class="line">        MainActivityModule.class,</span><br><span class="line">&#125;)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">MainActivityComponent</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">inject</span><span class="params">(MainActivity mainActivity)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Subcomponent</span>.Builder</span><br><span class="line">    <span class="class"><span class="keyword">interface</span> <span class="title">Builder</span> </span>&#123;</span><br><span class="line">        <span class="function">Builder <span class="title">mainModule</span><span class="params">(MainActivityModule mainModule)</span></span>;</span><br><span class="line"></span><br><span class="line">        <span class="function">MainActivityComponent <span class="title">build</span><span class="params">()</span></span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// åœ¨ MainActivity ä¸­</span></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">setupActivityComponent</span><span class="params">(AppComponent appComponent)</span> </span>&#123;</span><br><span class="line">    mainComponent = appComponent.mainComponentBuilder()</span><br><span class="line">            .mainModule(<span class="keyword">new</span> MainModule(<span class="keyword">this</span>))</span><br><span class="line">            .build();</span><br><span class="line">    mainComponent.inject(<span class="keyword">this</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™æ®µä»£ç éœ€è¦åœ¨ç”Ÿå‘½å‘¨æœŸæ–¹æ³•ä¸­è°ƒç”¨ï¼Œä¹‹åæ‰èƒ½æ­£å¸¸ä½¿ç”¨è¢«æ³¨å…¥çš„å¯¹è±¡ã€‚å¯ä»¥çœ‹åˆ° MainActivity éœ€è¦çŸ¥é“è‡ªèº«æ˜¯è¢« AppComponent æ‰€æ³¨å…¥ï¼Œè€Œè¢«æ³¨å…¥çš„ç±»å®é™…ä¸Šä¸è¯¥äº†è§£ï¼ˆæŒæœ‰ï¼‰æ³¨å…¥è€…ã€‚<code>dagger.android</code> å°±æ˜¯ä¸ºäº†åœ¨è¿™ä¸€ç‚¹ä¸Šè¿›è¡Œæ”¹è¿›ã€‚</p><h2 id="å…ˆè¡ŒçŸ¥è¯†"><a href="#å…ˆè¡ŒçŸ¥è¯†" class="headerlink" title="å…ˆè¡ŒçŸ¥è¯†"></a>å…ˆè¡ŒçŸ¥è¯†</h2><p>åœ¨å±•ç¤º <code>dagger.android</code> ä¹‹å‰ï¼Œéœ€è¦å…ˆäº†è§£ä¸€ä¸‹ dagger çš„ multibinding åŠŸèƒ½ï¼Œå¯¹äºç†è§£èƒŒåçš„è¿ä½œæœºåˆ¶æœ‰å¥½å¤„ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Module</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MultibindingModule</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Provides</span></span><br><span class="line">    <span class="meta">@IntoMap</span></span><br><span class="line">    <span class="meta">@StringKey</span>(<span class="string">"a"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">provideAValue</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"a value"</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Provides</span></span><br><span class="line">    <span class="meta">@IntoMap</span></span><br><span class="line">    <span class="meta">@StringKey</span>(<span class="string">"b"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">provideBValue</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"b value"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¸Šé¢çš„ä»£ç ï¼Œèƒ½å¤Ÿäº§ç”Ÿä¸€ä¸ª <code>Map&lt;String, String&gt;</code>ï¼ŒåŒ…å«äº†ä¸¤ä¸ª entryï¼Œå€¼åˆ†åˆ«æ˜¯ <code>a value</code> å’Œ <code>b value</code>ã€‚è¿™ä¸ª Map å¯ä»¥å½“æˆæ„é€ å‚æ•°ä¼ å…¥æŸä¸ªåœ°æ–¹ï¼Œä¹Ÿå¯ä»¥åƒä¸‹é¢çš„ä»£ç ä¸€æ ·ç›´æ¥åœ¨ Component ä¸­ä½¿ç”¨ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span>(modules = MultibindingModule.class)</span><br><span class="line"><span class="class"><span class="keyword">interface</span> <span class="title">MultibindingComponent</span> </span>&#123;</span><br><span class="line">    <span class="function">Map&lt;String, String&gt; <span class="title">aMap</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>çœ‹åˆ°è¿™é‡Œåº”è¯¥å¤§è‡´ä¼šæ˜ç™½ <code>@IntoMap</code> çš„ä½œç”¨äº†ã€‚æ­é… <code>@StringKey</code> æ³¨è§£ï¼Œ<code>@IntoMap</code> å¯ä»¥å°†æ–¹æ³•çš„è¿”å›å€¼åŠ å…¥ä¸€ä¸ª Mapã€‚å‡å¦‚éœ€è¦çš„ key çš„ç±»å‹ä¸æ˜¯ <code>String</code>ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨å…¶ä»–çš„æ³¨è§£ï¼Œæˆ–è€…è‡ªå®šä¹‰ä¸€ä¸ªæ³¨è§£ã€‚</p><p>æœ‰äº† multibinding åŠŸèƒ½ä¹‹åï¼Œå®é™…ä¸Šå·²ç»å¯ä»¥å°†æœ€åˆçš„æ³¨å…¥æ–¹æ¡ˆè¿›è¡Œæ”¹è¿›äº†ã€‚å…·ä½“å¯ä»¥å‚è€ƒè¿™ç¯‡æ–‡ç« <a href="https://medium.com/azimolabs/activities-subcomponents-multibinding-in-dagger-2-85d6053d6a95" target="_blank" rel="noopener">Activities Subcomponents Multibinding in Dagger 2</a>ã€‚</p><p><code>dagger.android</code> åœ¨åŸç†ä¸Šæ˜¯æ¥è¿‘çš„ï¼Œç®—æ˜¯ä¸€ç§æ ‡å‡†åŒ–ã€‚</p><h2 id="ä½¿ç”¨-dagger-android"><a href="#ä½¿ç”¨-dagger-android" class="headerlink" title="ä½¿ç”¨ dagger.android"></a>ä½¿ç”¨ <code>dagger.android</code></h2><p>ä»¥æ’°æ–‡æ—¶çš„æœ€æ–°ç‰ˆæœ¬ <code>2.11</code> ä¸ºä¾‹è¯´æ˜ã€‚å‡å®šæˆ‘ä»¬çš„åº”ç”¨ç»„ç»‡å±‚æ¬¡æ˜¯ <code>Appliction &lt;-- MainActivity &lt;-- MainFragment</code>ï¼Œè¿™æ ·æ–¹ä¾¿è¯´æ˜ã€‚</p><p>ç¬¬ä¸€ä»¶äº‹æ˜¯æ·»åŠ ä¾èµ–ã€‚<code>dagger.android</code> éœ€è¦åœ¨åŸæ¥çš„åŸºç¡€ä¸Šå†æ·»åŠ ä¾èµ–ï¼š</p><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">implementation <span class="string">'com.google.dagger:dagger-android:2.11'</span></span><br><span class="line">implementation <span class="string">'com.google.dagger:dagger-android-support:2.11'</span> <span class="comment">// å¦‚æœä½¿ç”¨ support library</span></span><br><span class="line">annotationProcessor <span class="string">'com.google.dagger:dagger-android-processor:2.11'</span></span><br><span class="line"><span class="comment">// kapt 'com.google.dagger:dagger-android-processor:2.11' // ä½¿ç”¨ Kotlin kapt</span></span><br></pre></td></tr></table></figure><p>åœ¨ AppComponent è¿™ä¸€çº§ï¼Œå°† <code>AndroidInjectionModule</code> åŠ å…¥ modulesï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span>(modules = &#123;</span><br><span class="line">        AndroidInjectionModule.class,</span><br><span class="line">        AppModule.class,</span><br><span class="line">&#125;)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">AppComponent</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">inject</span><span class="params">(ThisApplication application)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åœ¨ MainActivity è¿™ä¸€å±‚ï¼Œé¦–å…ˆç¡®ä¿ä½¿ç”¨çš„æ˜¯ <code>@Subcomponent</code>ï¼Œå¹¶ä¸”ä½¿ MainComponent ç»§æ‰¿ <code>AndroidInjector&lt;T&gt;</code>ã€‚è‡³äº <code>T</code> çš„ç±»å‹ï¼Œè¿™é‡Œéœ€è¦è¢«æ³¨å…¥çš„æ˜¯ MainActivityï¼Œæ‰€ä»¥å°±æ˜¯ <code>MainActivity</code>ã€‚åœ¨ Subcomponent å†…çš„ Builderï¼Œåˆ™éœ€è¦ç»§æ‰¿ <code>AndroidInejector.Builder&lt;MainActivity&gt;</code>ã€‚ç”±äº <code>AndroidInejector.Builder</code> æœ¬èº«æ˜¯æŠ½è±¡ç±»ï¼Œæ‰€ä»¥åŸæœ¬çš„ Builder ä¹Ÿéœ€è¦æ”¹ä¸ºæŠ½è±¡ç±»ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Subcomponent</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">MainActivityComponent</span> <span class="keyword">extends</span> <span class="title">AndroidInjector</span>&lt;<span class="title">MainActivity</span>&gt; </span>&#123;</span><br><span class="line">    <span class="meta">@Subcomponent</span>.Builder</span><br><span class="line">    <span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">Builder</span> <span class="keyword">extends</span> <span class="title">AndroidInjector</span>.<span class="title">Builder</span>&lt;<span class="title">MainActivity</span>&gt; </span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Module</span>(subcomponents = MainActivityComponent.class)</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">MainActivityModule</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Binds</span></span><br><span class="line">    <span class="meta">@IntoMap</span></span><br><span class="line">    <span class="meta">@ActivityKey</span>(MainActivity.class)</span><br><span class="line">    <span class="keyword">abstract</span> AndroidInjector.Factory&lt;? extends Activity&gt;</span><br><span class="line">    bindActivityInjectorFactory(MainActivityComponent.Builder builder);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¸Šé¢çš„ä»£ç ä¸­åŒæ—¶ä¹Ÿæ–°å¢äº† MainActivityModuleï¼ŒModule æ³¨è§£ä¸­å°† subcomponents æŒ‡å®šä¸º MainActivityComponentã€‚å…¶ä»–å†…å®¹ä¾è‘«èŠ¦ç”»ç“¢ã€‚å†å°† MainActivityModule æ·»åŠ åˆ° AppComponent ä¸­ï¼ˆæ„Ÿè°¢ <a href="https://github.com/xiaobailong24" target="_blank" rel="noopener">@xiaobailong24</a> æŒ‡å‡ºè¯¥å¤„é—æ¼ï¼‰ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span>(modules = &#123;</span><br><span class="line">        AndroidInjectionModule.class,</span><br><span class="line">        AppModule.class,</span><br><span class="line">        MainActivityModule.class,</span><br><span class="line">&#125;)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">AppComponent</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">inject</span><span class="params">(ThisApplication application)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åˆ°è¿™é‡Œï¼Œä¾èµ–éƒ¨åˆ†å·²ç»ç¼–å†™å®Œæ¯•ï¼Œæ¥ä¸‹æ¥æ˜¯ä½¿ç”¨ä¾èµ–ã€‚ä¿®æ”¹è‡ªå®šä¹‰çš„ Applicationï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ThisApplication</span> <span class="keyword">extends</span> <span class="title">Application</span> <span class="keyword">implements</span> <span class="title">HasActivityInjector</span> </span>&#123;</span><br><span class="line">  <span class="meta">@Inject</span> DispatchingAndroidInjector&lt;Activity&gt; dispatchingActivityInjector;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">super</span>.onCreate();</span><br><span class="line">    DaggerApplicationComponent.create().inject(<span class="keyword">this</span>);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> AndroidInjector&lt;Activity&gt; <span class="title">activityInjector</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> dispatchingActivityInjector;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Application å®ç°äº† HasActivityInjectorï¼Œæ–¹æ³•çš„å®ç°ä»…æ˜¯è¿”å›ä¸€ä¸ª dagger ä¸ºæˆ‘ä»¬æ³¨å…¥çš„å¯¹è±¡ã€‚</p><p>æœ€ååœ¨ Activity ä¸­ï¼Œåœ¨ <code>onCreate</code> æ–¹æ³•å‰ï¼Œè°ƒç”¨ä¸€ä¸ªæ–¹æ³•å³å¯ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MainActivity</span> <span class="keyword">extends</span> <span class="title">Activity</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">(Bundle savedInstanceState)</span> </span>&#123;</span><br><span class="line">    AndroidInjection.inject(<span class="keyword">this</span>);</span><br><span class="line">    <span class="keyword">super</span>.onCreate(savedInstanceState);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="ç®€å•åˆ†æ"><a href="#ç®€å•åˆ†æ" class="headerlink" title="ç®€å•åˆ†æ"></a>ç®€å•åˆ†æ</h2><p>æœ€åå®ç°æ³¨å…¥çš„ä»£ç ï¼Œæ— ç–‘æ˜¯ <code>AndroidInjection.inject(this)</code> è¿™ä¸€å¥ï¼Œé‚£ä¹ˆæ¥çœ‹çœ‹è¿™ä¸ªæ–¹æ³•çš„å®ç°ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">inject</span><span class="params">(Activity activity)</span> </span>&#123;</span><br><span class="line">    checkNotNull(activity, <span class="string">"activity"</span>);</span><br><span class="line">    Application application = activity.getApplication();</span><br><span class="line">    <span class="keyword">if</span> (!(application <span class="keyword">instanceof</span> HasActivityInjector)) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException(</span><br><span class="line">                String.format(</span><br><span class="line">                        <span class="string">"%s does not implement %s"</span>,</span><br><span class="line">                        application.getClass().getCanonicalName(),</span><br><span class="line">                        HasActivityInjector.class.getCanonicalName()));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    AndroidInjector&lt;Activity&gt; activityInjector =</span><br><span class="line">        ((HasActivityInjector) application).activityInjector();</span><br><span class="line">    checkNotNull(</span><br><span class="line">            activityInjector,</span><br><span class="line">            <span class="string">"%s.activityInjector() returned null"</span>,</span><br><span class="line">            application.getClass().getCanonicalName());</span><br><span class="line"></span><br><span class="line">    activityInjector.inject(activity);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä»£ç å¾ˆç®€å•ï¼Œå°±æ˜¯ä» Application å¾—åˆ° ActivityInjectorï¼Œè°ƒç”¨ <code>inject</code> æ–¹æ³•æ³¨å…¥è¿™ä¸ª activityã€‚Application æ‰€æŒæœ‰çš„ <code>DispatchingAndroidInjector</code>ï¼Œå†…éƒ¨ç»´æŠ¤äº†ä¸€ä¸ª mapã€‚å¯ä»¥æ³¨æ„åˆ°ï¼Œè¿™ä¸ª map çš„ç±»å‹æ˜¯ <code>Map&lt;Class&lt;? extends T&gt;, Provider&lt;AndroidInjector.Factory&lt;? extends T&gt;&gt;&gt;</code>ï¼Œå¹¶ä¸”æ„é€ æ–¹æ³•ä½¿ç”¨äº† <code>@Inject</code> æ³¨è§£æ¥æ³¨å…¥è¿™ä¸ª mapã€‚å¯çŸ¥è¿™ä¸ª map ä¾¿æ˜¯æˆ‘ä»¬ä½¿ç”¨ <code>@ActivityKey</code> å’Œ <code>@IntoMap</code> æ‰€äº§ç”Ÿçš„ã€‚</p><p>AndroidInjector.Factory çš„å®ç°åˆ™æ˜¯æˆ‘ä»¬æ‰€å†™çš„ Subcomponent.Builderã€‚é€šè¿‡ MainActivity.class åœ¨ map é‡Œå¾—åˆ°å¯¹åº”çš„ AndroidInjector.Factory åï¼Œå°±å¯ä»¥åˆ›å»ºå¯¹åº”çš„ Componentâ€”â€”ä¹Ÿå°±æ˜¯ AndroidInjectorâ€”â€”æ¥ç€å°±å¯ä»¥å°† Component æ‰€æ‹¥æœ‰çš„ç±»å‹æ³¨å…¥è¿› Activity äº†ã€‚</p><h2 id="è¡¥å……å†…å®¹"><a href="#è¡¥å……å†…å®¹" class="headerlink" title="è¡¥å……å†…å®¹"></a>è¡¥å……å†…å®¹</h2><p>è§‚å¯Ÿä¸Šé¢ä¾‹å­é‡Œçš„ MainActivityComponentï¼Œä¼šå‘ç°è¿™ä¸ªæ¥å£çš„å®é™…å†…å®¹åªæœ‰æŒ‡å®šäº† MainActivity çš„ç±»å‹ï¼Œå…¶ä»–çš„éƒ¨åˆ†éƒ½æ˜¯å›ºå®šçš„ã€‚å‡å°‘ boilerplate code æ˜¯ dagger çš„ç›®çš„ä¹‹ä¸€ï¼Œæ‰€ä»¥é’ˆå¯¹è¿™ç§æƒ…å†µï¼Œdagger æ·»åŠ äº†ä¸€ä¸ª <code>@ContributesAndroidInjector</code> æ³¨è§£ï¼Œç”¨æ¥ç”Ÿæˆè¿™æ ·çš„ Subcomponentã€‚</p><p><code>@ContributesAndroidInjector</code> ä½¿ç”¨åœ¨ module ä¸­çš„æŠ½è±¡æ–¹æ³•ä¸Šã€‚è¯¥æ–¹æ³•ä¸è¯¥æœ‰å‚æ•°ï¼Œè¿”å›ç±»å‹å¿…é¡»æ˜¯ Activityã€Fragment å’Œ Service ç­‰ Android Framework çš„ç±»å‹ã€‚dagger å°†ä¼šä¸ºè¿™æ ·çš„ä¸€ä¸ªæ–¹æ³•ç”Ÿæˆä¸€ä¸ªå¯¹åº”çš„ Subcomponentã€‚è¿™ä¸ªæ³¨è§£è¿˜èƒ½æ¥å—ä¸€ç³»åˆ— Module ä½œä¸ºå€¼ï¼Œè¿™äº› module å°†ä¼šæˆä¸ºæ‰€ç”Ÿæˆçš„ Subcomponent çš„ moduleã€‚</p><p>å¯¹åº”ä¸Šé¢çš„ä¾‹å­ï¼Œå¯ä»¥å°† MainActivityComponent æ–‡ä»¶åˆ é™¤ï¼Œç„¶åå°† MainActivity æ”¹ä¸ºå¦‚ä¸‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Module</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">MainActivityModule</span> </span>&#123;</span><br><span class="line">    <span class="meta">@ContributesAndroidInjector</span></span><br><span class="line">    <span class="function"><span class="keyword">abstract</span> MainActivity <span class="title">contributeMainActivity</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä½¿ç”¨ ProGuard æ—¶ï¼Œéœ€è¦åŠ å…¥å¦‚ä¸‹è§„åˆ™ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># dagger</span><br><span class="line">-dontwarn dagger.android.**</span><br></pre></td></tr></table></figure><p>å¦‚æœä½ æƒ³çœ‹å®é™…ä½¿ç”¨çš„ä¾‹å­ï¼Œå¯ä»¥å‚è€ƒæˆ‘çš„ <a href="https://github.com/Loong-T/Android-Showcase" target="_blank" rel="noopener">Android Showcase</a>ã€‚</p><h2 id="è·‹"><a href="#è·‹" class="headerlink" title="è·‹"></a>è·‹</h2><p><code>dagger</code> çš„åŸºç¡€ä½¿ç”¨å¹¶ä¸æ˜¯å¾ˆéš¾ã€‚ä½†åœ¨ç»“åˆå®é™…é¡¹ç›®åï¼Œéœ€è¦åˆç†ç»„ç»‡å±‚çº§ï¼Œè€ƒè™‘ Scope çš„ä½¿ç”¨ï¼Œé…åˆä¸Šé¢å¤–çš„ <code>Subcomponent</code> ç­‰ç­‰ï¼Œå†åŠ ä¸Š Android ç‹¬ç‰¹çš„ç¯å¢ƒï¼Œå¾€å¾€ä¼šå˜å¾—å¤æ‚è€Œç¹çã€‚è€Œ <code>dagger.android</code> å¾ˆå¥½åœ°ç®€åŒ–äº† DI çš„ä½¿ç”¨ï¼Œèƒ½å¤Ÿå°†æ›´å¤šç²¾åŠ›æ”¾åˆ°å®é™…çš„åº”ç”¨ä¸Šï¼Œä¸ªäººæ¨èä½¿ç”¨ã€‚</p>]]></content>
      
      
        <tags>
            
            <tag> Android </tag>
            
            <tag> Dagger </tag>
            
            <tag> ä¾èµ–æ³¨å…¥ </tag>
            
            <tag> DI </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>è¿ç§»åšå®¢åˆ° GitHub Pages</title>
      <link href="/2017/02/19/%E8%BF%81%E7%A7%BB%E5%8D%9A%E5%AE%A2%E5%88%B0-GitHub-Pages/"/>
      <url>/2017/02/19/%E8%BF%81%E7%A7%BB%E5%8D%9A%E5%AE%A2%E5%88%B0-GitHub-Pages/</url>
      <content type="html"><![CDATA[<p>æœ€è¿‘è¡¥äº†ä¸€ä¸‹ Web æ–¹é¢çš„çŸ¥è¯†ï¼Œå¿ƒæƒ³ç€å°±é¡ºå¸¦æŠŠåšå®¢é‡æ–°é¼“æ£ä¸€ä¸‹ã€‚</p><p>ä»¥å‰çš„åšå®¢â€”â€”å¾ˆä¹…æ²¡æ›´æ–°äº†â€”â€”æ˜¯ç§Ÿäº†ä¸ªä¾¿å®œçš„è™šæ‹Ÿä¸»æœºï¼Œç”¨ WordPress æ­çš„ã€‚å¹¶ä¸æ‡‚ PHPï¼Œè€Œä¸”ä¸€æ®µæ—¶é—´é‡Œä¹Ÿåº”è¯¥ä¸ä¼šå»å­¦ã€‚å¦‚æœæˆ‘è‡ªå·±æƒ³è¦æç‚¹è‡ªå·±æƒ³è¦çš„ä¸»é¢˜ï¼Œå®é™…ç»ƒä¹ ä¸€ä¸‹è‡ªå·±çš„ Web æŠ€æœ¯ï¼Œä¼šæ¯”è¾ƒå›°éš¾ã€‚ä»˜è´¹ä¹ŸæŒºéº»çƒ¦çš„ï¼Œå¹²è„†å°±æŠŠè¿™ä¸€ä¸ªæœˆå‡ å—é’±ä¹Ÿçœäº†ç®—äº†ã€‚</p><a id="more"></a><p>äºæ˜¯ GitHub Pages æˆäº†é¦–é€‰ï¼Œç®€å•æ–¹ä¾¿ã€‚å› ä¸ºæ˜¯é™æ€ç½‘ç«™ï¼Œæƒ³è¦è‡ªå·±ç»ƒä¸ªæ‰‹ä¹Ÿå¾ˆå®¹æ˜“ã€‚</p><p>é™æ€ç½‘ç«™ç”Ÿæˆæ–¹é¢ï¼Œæˆ‘é€‰ç”¨äº† Hexoã€‚GitHub å®˜æ–¹æ¨è Jekyllï¼Œä½†ç”±äºæƒ³å°ä¸ªé²œï¼Œå°±é€‰ç”¨äº†æ¯”è¾ƒç«çš„ Hexoã€‚ç„¶åå‘ç° Hexo æ˜¯åŸºäº Node çš„ï¼Œä¸ç¦æƒ³æ„Ÿå¹ JS å’Œ Node çœŸæ˜¯å¦‚æ—¥ä¸­å¤©ã€‚</p><p>ç„¶åæ‰¾äº†ä¸ªçœ‹ç€é¡ºçœ¼çš„ä¸»é¢˜ <a href="https://material.viosey.com" target="_blank" rel="external">Material</a>ã€‚è¿™ä¸ªä¸»é¢˜è§†è§‰è®¾è®¡ä¸Šå¾ˆæ£’ï¼Œå¹¶ä¸æ˜¯å¸¸è§çš„é‚£äº›å¹³åº¸ä¸‘é™‹çš„ Material Designã€‚ç„¶è€Œæ„Ÿè§‰åœ¨å¸ƒå±€å’ŒåŠŸèƒ½çš„è®¾è®¡ä¸Šè¿˜æ˜¯ä¸å°½æˆ‘æ„ï¼Œäº‰å–æ›´ç†Ÿæ‚‰äº†ä¹‹åè‡ªå·±é€ ä¸€ä¸ªå§ã€‚å¥½åœ¨ä¸»é¢˜æä¾›äº†å‡ ç§æ ·å¼ï¼Œå…¶ä¸­çš„ Isolation ååˆ†ç®€æ´ç¾è§‚ï¼Œäºæ˜¯å†³å®šå…ˆä½¿ç”¨è¿™ä¸ªã€‚</p><p>ç¨å¾®è‡ªå®šä¹‰äº†ä¸€ä¸‹ä¸»é¢˜ï¼Œç°åœ¨æ­£åœ¨å†™ç¬¬ä¸€ç¯‡åšæ–‡ã€‚æ¥ä¸‹æ¥å°±æ˜¯æå®šéƒ¨ç½²å’ŒåŸŸåç»‘å®šã€‚</p><p>å†é•¿è¿œä¸€ç‚¹çš„è®¡åˆ’ï¼Œå°±æ˜¯æ”¯æŒç¤¾ä¼šåŒ–è¯„è®ºç³»ç»Ÿå’Œ Https äº†ã€‚</p><p>åŸå…ˆçš„è¯„è®ºç³»ç»Ÿç”¨çš„æ˜¯å¤šè¯´ã€‚åˆ«çš„ä¸è¯´ï¼Œé»˜è®¤å¾ˆä¸‘ã€‚ç”±äºä¹Ÿæ²¡æ‰“ç®—æŠŠåŸå…ˆçš„æ•°æ®è½¬åˆ°è¿™é‡Œæ¥ï¼ŒåŠ ä¸Šä¸æ”¯æŒ Httpsï¼Œæ‰€ä»¥ä¸æ‰“ç®—å†ä½¿ç”¨å¤šè¯´ã€‚Disqus åœ¨å›½å†…è¢«å¢™äº†ï¼Œç”±äºåŸºæœ¬éƒ½æ˜¯ç¿»å¢™çš„ï¼Œæ‰€ä»¥ä¸€ç›´æ²¡æ³¨æ„åˆ°è¿™ç‚¹ã€‚å¥½åœ¨äº†è§£åˆ°ç½‘æ˜“äº‘è·Ÿå¸–æ˜¯æ”¯æŒ Https çš„ï¼Œäºæ˜¯è®¡åˆ’ä½¿ç”¨å®ƒã€‚</p>]]></content>
      
      
        <tags>
            
            <tag> Blog </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>è¯»ã€Šç¦»æ°´ä¹‹é±¼ã€‹</title>
      <link href="/2015/05/11/%E8%AF%BB%E3%80%8A%E7%A6%BB%E6%B0%B4%E4%B9%8B%E9%B1%BC%E3%80%8B/"/>
      <url>/2015/05/11/%E8%AF%BB%E3%80%8A%E7%A6%BB%E6%B0%B4%E4%B9%8B%E9%B1%BC%E3%80%8B/</url>
      <content type="html"><![CDATA[<p><a href="http://book.douban.com/subject/10773372/" target="_blank" rel="external">ã€Šç¦»æ°´ä¹‹é±¼ã€‹</a></p><p>ä¸ªäººè¯„ä»·ï¼š2 æ˜Ÿã€‚</p><p>å¹¶æ²¡æœ‰è¯»å®Œï¼Œè¿‡ç¨‹ä¸­å°±æ„Ÿåˆ°æœ‰å¾ˆå¤šé—®é¢˜ï¼Œæƒ³ç€è¿™çœŸæ˜¯æœ¬é¸¡æ±¤çš„åé¢ç¤ºèŒƒã€‚æœ‰äº†äº›æƒ³æ³•åï¼Œå°±è§‰å¾—æ˜¯èƒ½å¤Ÿç”¨æ¥å†™ç‚¹ä»€ä¹ˆçš„ã€‚äºæ˜¯å‡†å¤‡å†™ä¸ªè¯»åæ„Ÿï¼Œåœ¨å‡†å¤‡é˜¶æ®µå‘è§‰ï¼Œç»†çœ‹è¿™æœ¬ä¹¦æ›´æ˜¯ç³Ÿç³•ã€‚</p><p>å°½é‡å†™ä¸€äº›ä¸ªäººå¯¹äºé¸¡æ±¤ç±»å‹æ–‡å­—çš„æƒ³æ³•ã€‚è™½ç„¶æ¯æ¬¡æ·±å…¥å»æ€è€ƒè¿™äº›ç³Ÿç³•çš„é¸¡æ±¤ä¹Ÿä¼šæœ‰æ‰€æ”¶è·â€”â€”ä¸»è¦æ˜¯æŒ‡ä¸ºä»€ä¹ˆç³Ÿç³•è¿™æ–¹é¢ï¼Œä½†ç›¸å½“è€—è´¹æ—¶é—´ï¼Œå¹¶ä¸å€¼å¾—è¿™æ ·çš„æŠ•å…¥ã€‚æ‰€ä»¥æœ€å¥½è¿™ç¯‡è¯»åæ„Ÿèƒ½æˆä¸ºç³Ÿç³•é¸¡æ±¤æ–‡çš„æœ€åä¸€ç¯‡æ„Ÿæƒ³ã€‚</p><a id="more"></a><hr><p>é¦–å…ˆæ¥çœ‹çœ‹å…¨ä¹¦çš„ç»“æ„ã€‚</p><p>ç›®å½•çš„ä¸»ä½“æ˜¯ä»¥ Step åŠ æ•°å­—å¼€å¤´çš„ç« èŠ‚åç§°ï¼Œç„¶åå‰ååŠ ä¸Šå‰è¨€ã€è¯­å½•ã€è‡´è°¢ã€‚æ²¡æœ‰æ›´å¤šçš„ä¸œè¥¿äº†ã€‚ä¸»è¦å†…å®¹åˆ†ä¸º 7 ç« ï¼Œè¯´ä¸ä¸Šå¤šï¼Œåœ¨æ²¡æœ‰äºŒçº§ç»“æ„çš„æƒ…å†µä¸‹ï¼Œç»„æˆäº†ä¸€æœ¬ 250 é¡µç•¥å°‘çš„ä¹¦ï¼Œè®©æˆ‘è§‰å¾—æœ‰äº›å¾®å¦™ã€‚</p><p>æˆ‘åˆ—ä¸€ä¸‹ï¼š</p><blockquote><p>å‰è¨€<br>Step 1 æ‰¾åˆ°çœŸå®çš„è‡ªæˆ‘<br>Step 2 æŠŠç‹¬ç‰¹ä¹‹å¤„å½“åšè¯±é¥µ<br>Step 3 æ‰¾åˆ°åŒç±»<br>Step 4 ç”¨è‡ªå·±çš„æ–¹å¼ï¼Œåœ¨åˆ«äººçš„æµ·æ´‹é‡Œç•…æ¸¸<br>Step 5 æŠŠè‡ªå·±æ¨åˆ°å°å‰<br>Step 6 å¹¿æ’’ç½‘ï¼Œå¸¸è¿›æ­¥<br>Step 7 è¿ç”¨ä½ çš„ç‹¬ç‰¹åŠ›é‡ï¼ŒåŠåˆ°ä¸°ç›ˆæ”¶è·<br>ç¦»æ°´ä¹‹é±¼ç²¾å½©è¯­å½•<br>è‡´è°¢</p></blockquote><p>è¿™ä¸ª Step 1~7ï¼Œå°±æ˜¯ä½œè€…æ€»ç»“å‡ºçš„â€œç¦»æ°´é±¼å„¿ä¸ƒæ­¥æ³•â€ï¼Œç”¨æ¥å¸®åŠ©ç¦»æ°´ä¹‹é±¼å‘ç°è‡ªå·±çš„ç‹¬ç‰¹æ½œåŠ›ã€‚ä»è¿™ä¸€ç‚¹ä¸Šæ¥çœ‹ï¼Œç»“æ„ç´§æ‰£ä¸»é¢˜ï¼Œä¸­è§„ä¸­çŸ©ã€‚</p><p>è€Œååœ¨è¯»çš„æ—¶å€™ï¼Œä¼šå‘ç°æ–‡ä¸­æœ‰äºŒçº§æ ‡é¢˜æ ¼å¼çš„å†…å®¹ï¼Œä½†å´æ€ä¹ˆçœ‹éƒ½ä¸åƒæ˜¯äºŒçº§æ ‡é¢˜ã€‚</p><p>å› ä¸ºæ‡’ï¼Œæˆ‘å°±åˆ—ä¸ªç¬¬ä¸€ç« çš„å†…å®¹ï¼š</p><blockquote><p>Step 1 æ‰¾åˆ°çœŸå®çš„è‡ªæˆ‘<br>    äº†è§£è‡ªæˆ‘æ˜¯ä¸€è¾ˆå­çš„äº‹å„¿<br>    ç”Ÿæ´»åœ¨ææƒ§å½“ä¸­ï¼Œç­‰äºæ ¹æœ¬æ²¡æœ‰æ´»è¿‡<br>    çœŸå®æ„å‘³ç€è¨€è¡Œä¸€è‡´ï¼Œæ„å‘³ç€çœŸè¯šï¼Œæ¯«ä¸çŸ«é¥°<br>    è¡¨è¾¾æƒ…ç»ªï¼Œä¸€å®šè¦é€‰å¯¹æ—¶æœº<br>    è¿™ä¸€ç”Ÿä¸­ï¼Œæˆ‘ä»¬å¯ä»¥æ‹¥æœ‰ä¸åŒçš„èº«ä»½ï¼Œæ‹¥æœ‰å¤šç§èŒä¸š<br>    è°ˆè°ˆä»¤ä½ è‡ªè±ªçš„ä¸œè¥¿ï¼Œä¸è¦åšå–åŒæƒ…ï¼Œä¸è¦å¯ä»¥åœ°â€œè§¦åŠ¨å¿ƒå¼¦â€<br>    å‹‡æ•¢åœ°å±•ç¤ºè‡ªæˆ‘ï¼Œç ´é™¤ä»–äººçš„æˆè§<br>    ä¸ºè‡ªå·±å¿ƒæ€€æ­‰æ„ï¼Œåˆ«äººä¼šè®¤ä¸ºä½ æ˜¯å¯æ€œè™«<br>    å½“ä½ è·Ÿåˆ«äººéƒ½ä¸ä¸€æ ·çš„æ—¶å€™ï¼Œä½ å·²ç»å¸å¼•äº†æ—äººçš„æ³¨æ„<br>    è¦çŸ¥é“è‡ªå·±é€‚åˆä»€ä¹ˆã€æ“…é•¿ä»€ä¹ˆ<br>    å³ä½¿åœ¨æœ€é˜´æš—çš„æ—¥å­é‡Œï¼Œä¹Ÿä¼šæœ‰å…‰æ˜<br>    å¦‚æœä½ æ˜¯ä¸€æ¡ç¦»æ°´é±¼å„¿ï¼Œæ„Ÿæ©çš„å¿ƒæ€ä¸èƒ½å°‘<br>    èŒåœºä¸­çš„é‡è¦ç¾å¾·</p></blockquote><p>æˆ‘èªŠæŠ„è¿™äº›å°æ ‡é¢˜çš„æ—¶å€™ï¼Œå°±å¿«è¢«æ°”ç‚¸äº†ï¼šä»€ä¹ˆç‹—å±ç©æ„å„¿ï¼</p><p>é¦–å…ˆå¯ä»¥è‚¯å®šçš„æ˜¯ï¼Œç¿»è¯‘å®šç„¶ç®—ä¸ä¸Šé«˜æ°´å‡†ï¼Œä¹Ÿå°±æ˜¯è¿‡äº†ä¸ªé€šé¡ºçš„åå„¿ã€‚â€œå³ä½¿åœ¨æœ€é˜´æš—çš„æ—¥å­é‡Œï¼Œä¹Ÿä¼šæœ‰å…‰æ˜â€ï¼Œè¿™æ ·çš„å¥å­ï¼Œä»¥æˆ‘è¿™ä¹ˆæ²¡æ–‡åŒ–çš„äººæ¥ï¼Œä¹Ÿè¯¥æ˜¯ç¿»æˆâ€œé»‘æš—ä¸­ç»ˆèƒ½è§å…‰æ˜â€ä¹‹ç±»çš„ã€‚</p><p>å…ˆä¸è®ºå°æ ‡é¢˜æƒ³è¦è¡¨è¾¾çš„æ„æ€æ˜¯å¦çœŸçš„ç®¡ç”¨ï¼Œæ¥çœ‹å°æ ‡é¢˜æ˜¯ä¸æ˜¯çœŸæœ‰è¡¨è¾¾å‡ºæ„æ€æ¥å§ã€‚</p><p>æœ€åä¸€æ¡ï¼Œâ€œèŒåœºä¸­çš„é‡è¦ç¾å¾·â€ï¼Œè¿™ç§è¡¨è¿°æ–¹å¼ï¼Œéš¾é“ä¸æ˜¯ç™½å†™å—ï¼Ÿè‡³å°‘è¯·å‘Šè¯‰æˆ‘åˆ°åº•æ˜¯ä»€ä¹ˆç¾å¾·å§ï¼Ÿ</p><p>â€œæˆ–è®¸æ˜¯å¤ªé•¿äº†ä¸å¥½æ”¾åœ¨å°æ ‡é¢˜å†…ã€‚â€æˆ‘è¿™ä¹ˆçŒœæµ‹ã€‚</p><p>äºæ˜¯å»çœ‹æ ‡é¢˜ä¸‹çš„å†…å®¹ï¼Œç¬¬ä¸€å¥èµ«ç„¶ä¾¿æ˜¯ï¼šâ€œé‡è¦æç¤ºï¼šå¦‚æœä½ ä¸å¤ŸçœŸå®ï¼ŒåŒäº‹ä»¬ä¸€çœ¼å°±èƒ½çœ‹ç©¿ã€‚â€</p><p>äºæ˜¯ä½ æŠŠè¿™å¥è¯ç›´æ¥æ”¾åˆ°å°æ ‡é¢˜æœ‰ä»€ä¹ˆä¸å¦¥å—ï¼Ÿï¼å“¦ï¼Œæ˜¯æ€•åˆ«äººå‘ç°è¿™å…¶å®è·Ÿå‰é¢çš„â€œçœŸå®æ„å‘³ç€è¨€è¡Œä¸€è‡´ï¼Œæ„å‘³ç€çœŸè¯šï¼Œæ¯«ä¸çŸ«é¥°â€è®²è¿°çš„åŒä¸€å›äº‹å„¿å—ï¼Ÿ</p><p>çœŸæ˜¯å“”äº†ç‹—äº†â€¦</p><p>æ€»ç»“èµ·æ¥ï¼Œä¸Šé¢æåˆ°äº†ä¸¤ä¸ªé—®é¢˜ï¼šä¸çŸ¥æ‰€äº‘ã€é‡å¤ã€‚</p><p>å¦å¤–çš„é—®é¢˜æœ‰ï¼šæ— å…³ã€ç½—å—¦ã€‚æˆ‘ä¹Ÿæ‡’äºç»†è‡´æŒ‘åˆºã€‚</p><hr><p>ä»å†…å®¹çš„ç»„ç»‡ç»“æ„æ¥çœ‹ï¼Œæˆ‘é¢‡ä¸ºæ€€ç–‘ä½œè€…æ˜¯å¦çœŸçš„äº†è§£å¦‚ä½•è§£å†³é—®é¢˜ã€‚</p><p>å½“ç¢°è§ä¸€ä¸ªé—®é¢˜åï¼Œæ­£ç»Ÿçš„æ€ç»´åº”å½“æ˜¯å»æ€è€ƒ whatã€howã€whyã€‚</p><ul><li>Whatï¼šé—®é¢˜æ˜¯ä»€ä¹ˆï¼Œé—®é¢˜ä¸­æ¶‰åŠçš„ä¸œè¥¿æ˜¯ä»€ä¹ˆã€‚</li><li>Howï¼šè§£å†³çš„æ‰‹æ®µã€é€”å¾„ã€‚</li><li>Whyï¼šä¸ºä»€ä¹ˆè¿™æ ·æ˜¯æœ‰æ•ˆçš„ï¼Œæ ¹æ®æ˜¯ä»€ä¹ˆã€‚</li></ul><p>ä»¥ä¸Šæ˜¯æˆ‘ä¸ªäººç»éªŒçš„ç²—æµ…æ€»ç»“ï¼Œå‡è‹¥æœ‰æ‰€ä¸å¦¥ï¼Œè¯·ä¸åæŒ‡æ•™ã€‚</p><p>Step 1 çš„å†…å®¹ï¼Œå®é™…ä¸Šæ˜¯â€œå¦‚ä½•æ‰¾åˆ°çœŸå®çš„è‡ªæˆ‘â€ã€‚</p><p>å°†ä¸Šè¿°æ€ç»´å¥—ç”¨åœ¨è¯¥é—®é¢˜ä¸Šï¼š</p><ul><li>Whatï¼šä»€ä¹ˆæ˜¯çœŸå®çš„è‡ªæˆ‘ï¼Ÿ</li><li>Whyï¼šä¸ºä»€ä¹ˆè¦æ‰¾åˆ°çœŸå®çš„è‡ªæˆ‘ï¼Ÿ</li><li>Howï¼šæ€ä¹ˆæ‰¾åˆ°çœŸå®çš„è‡ªæˆ‘ï¼Ÿ</li></ul><p>è¿™æ ·ä¸€æ¥ï¼Œè¡Œæ–‡çš„ç»“æ„å°±æ¸…æ™°æ˜äº†ï¼Œä¹Ÿæœ‰ç†æœ‰æ®ä»¤äººä¿¡æœã€‚</p><hr><p>ä½†ä½œè€…è¿˜æ˜¯æ·±çŸ¥å¼•äººæ³¨æ„çš„è¦è¯€çš„ï¼šè®²æ•…äº‹ã€‚å…¨ä¹¦ç©¿æ’ç€å¤§é‡çš„æ•…äº‹ï¼Œè‡ªå·±çš„ï¼Œåˆ«äººçš„ï¼Œæ€»è€Œè¨€ä¹‹å°±æ˜¯å„ç§æˆåŠŸäººå£«çš„ã€‚</p><p>å¤§æ¦‚æ˜¯å‡ºäºåŠ å¼ºè¯´æœåŠ›ä¸ä»£å…¥æ„Ÿçš„è€ƒè™‘ï¼Œå¤§éƒ¨åˆ†çš„æ•…äº‹éƒ½æ˜¯ä½¿ç”¨ç¬¬ä¸€äººç§°æ¥å™è¿°çš„ã€‚ä½†é™äºè´«ç˜ çš„è®²æ•…äº‹èƒ½åŠ›â€”â€”æˆ–è®¸æ˜¯ç¿»è¯‘çš„é”™â€”â€”æ•…äº‹æ¯«æ— å¸å¼•åŠ›ï¼Œäººç‰©ä¹Ÿæ¯«æ— å¼ åŠ›ã€‚åªæ˜¯å•çº¯çš„ä¾‹å­è€Œå·²ï¼Œè·Ÿ 1+1=2 å¹¶æ²¡æœ‰ä»€ä¹ˆä¸¤æ ·ã€‚è€Œä¸”æ•…äº‹çš„èƒŒæ™¯ä¹Ÿä¸æˆ‘ä¸ªäººçš„ç»å†ç›¸è·ç”šè¿œï¼Œåƒç¯‡ä¸€å¾‹ã€‚</p><p>æˆ‘ä¸æ˜¯å¾ˆå¾…è§é¸¡æ±¤ç±»å‹çš„ä¹¦ï¼Œå› ä¸ºå¤§éƒ¨åˆ†å°±æ˜¯è¡¨è¾¾ä¸€ä¸ªè§‚ç‚¹ï¼Œç„¶åä¸¾ä¾‹å­æ¥æ”¯æŒè‡ªå·±çš„è§‚ç‚¹ã€‚ä½†è¿™äº›ä¾‹å­åªèƒ½ç”¨æ¥æ”¯æŒï¼Œæ— æ³•è¯æ˜è¯¥è§‚ç‚¹ã€‚</p><p>è¿™äº›ä¾‹å­ææœ‰å¯èƒ½æ˜¯ç»è¿‡æŒ‘é€‰çš„ã€‚æ¯”å¦‚å¯¹äºä¸€ä¸ªæˆåŠŸå­¦çš„è§‚ç‚¹ï¼Œä½œè€…æŒ‘äº†ä¸€ä¸ªå…¸å‹çš„ä¾‹å­ï¼Œä½†å´å®Œå…¨æ²¡æœ‰æåˆ°å…¶ä»–ä¸æ”¯æŒè¯¥è§‚ç‚¹çš„ä¾‹å­ã€‚</p><p>å¾ˆå¤šé¸¡æ±¤ä¹Ÿå¤ªè¿‡æš§æ˜§ä¸æ¸…äº†ã€‚ä»¥æœ¬ä¹¦æ¥è¯´æ˜ï¼Œä¸Šé¢çš„æçº²ä¸­æåˆ°â€œå‹‡æ•¢åœ°å±•ç°è‡ªæˆ‘â€ï¼Œå´åˆè¯´â€œè¡¨è¾¾æƒ…ç»ªï¼Œä¸€å®šè¦é€‰å¯¹æ—¶æœºâ€ã€‚è¿™ä¸å•»äºè¯´ï¼šâ€œåšäº‹ï¼Œè¦è®²ç©¶â€˜åº¦â€™ã€‚â€</p><p>è¿™è§‚ç‚¹æœ¬èº«å¹¶æ²¡æœ‰é”™ï¼Œå´æ˜¯åºŸè¯ã€‚å¤§é“ç†æˆ‘æƒ³å¤§éƒ¨åˆ†äººéƒ½æ˜ç™½ï¼Œä½†è¿™ä¸ªâ€œåº¦â€åˆ°åº•è¦å¦‚ä½•å¹³è¡¡å‘¢ï¼Ÿè¿™æ‰æ˜¯çœŸæ­£çš„é—®é¢˜å•Šã€‚å¤§éƒ¨åˆ†é¸¡æ±¤ç›¸å½“äºåœ¨è¯´ï¼šâ€œä¹°è‚¡ç¥¨æ˜¯å¯ä»¥èµšå¤§é’±çš„ï¼Œä½†å‰ææ˜¯ä½ è¦ä¹°å¯¹ã€‚â€</p><p>å•§ï¼Œé‚£åˆ°åº•æ€ä¹ˆæ‰èƒ½ä¹°å¯¹ï¼Œä½ å€’æ˜¯å‘Šè¯‰æˆ‘å•Šã€‚</p><hr><p>æ‰¹åˆ¤å°±å®Œäº†ã€‚è™½ç„¶è¯»æ—¶å¿ƒä¸­æƒ³æ³•åƒè½¬ï¼Œåˆ°è‘—æ–‡æ—¶å´åƒæ˜¯å®Œå…¨æ²¡äº†å¤´è„‘ã€‚è€Œä¸”å†™å¾—ä¹Ÿå®Œå…¨æ²¡æœ‰è¶£å‘³ã€‚</p><p>æˆ‘ä¸ºä»€ä¹ˆè¦ä¹°è¿™æœ¬ä¹¦å‘¢ï¼Ÿ</p><p>ç»ä¸ä½è´­ç‰©ä¼˜æƒ çš„è¯±æƒ‘ï¼ŒæŒ‘ä¹¦çš„æ—¶å€™ç¥è§äº†ä¹¦åâ€”â€”ã€Šç¦»æ°´ä¹‹é±¼ ä¸ä¼—ä¸åŒä¸€æ—çš„ç”Ÿå­˜æ³•åˆ™ã€‹ã€‚è¿˜æ˜¯ä¸å¾—ä¸æ‰¿è®¤è¿™ä¸ªè¯é¢˜å¯¹äºè‡ªè§‰ç¦»æ°´ä¹‹é±¼çš„äººï¼Œæ¯”å¦‚æˆ‘ï¼Œæ˜¯éå¸¸æœ‰å¸å¼•åŠ›çš„ã€‚ç»è¿‡æŠ€æœ¯ä¹¦ç±çš„ä»·æ ¼è½°ç‚¸ï¼Œå¯¹äºè¿™ç±»ä¹¦å®šä»·çš„æƒ³æ³•ï¼Œå®Œå…¨å°±æ˜¯çœŸä¾¿å®œçœŸä¾¿å®œä¹°ä¹°ä¹°ã€‚</p><p>ä¸è¿‡äº‹å®è¯æ˜è¿™ç±»ä¹¦ç±æ°´åˆ†ä¹Ÿå……è¶³å¾—è®©æˆ‘æ€»æ˜¯è§‰å¾—â€œåˆæ˜¯ä¸€ç¬”äºæœ¬ä¹°å–â€ã€‚</p><p>æˆ‘ä¹°æ¥çœ‹äº†ä¸€å°éƒ¨åˆ†åï¼Œå‘è§‰æˆ‘ä¸ä½œè€…å¯¹äºâ€œç¦»æ°´ä¹‹é±¼â€çš„ç†è§£æ˜¯ä¸ä¸€æ ·çš„ã€‚</p><p>ä¹¦ä¸­å®šä¹‰è¯´ï¼šç¦»æ°´ä¹‹é±¼æ˜¯æŒ‡è„±ç¦»äº†é€‚åˆç”Ÿå­˜ç¯å¢ƒçš„é±¼ã€‚é€‚åˆåˆ«äººç”Ÿæ´»çš„ä¸€èˆ¬ç¯å¢ƒï¼Œå¯¹äºè¿™æ ·çš„é±¼æ¥è¯´ï¼Œæ˜¯æ— æ°´ç¯å¢ƒã€‚</p><p>è€Œæˆ‘è‡ªå·±çš„æƒ³æ³•æ˜¯ï¼Œç¦»æ°´è¡¨ç¤ºçš„å¹¶ä¸æ˜¯çŠ¶æ€ï¼Œè€Œæ˜¯å‘å¾€ã€‚ç¦»æ°´ä¹‹é±¼æ˜¯é‚£äº›æ¸´æœ›è„±ç¦»æ°´ç”Ÿå­˜çš„äººã€‚</p>]]></content>
      
      
        <tags>
            
            <tag> è¯»ä¹¦ </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>åœ¨ SwipeRefreshLayout ä¸­åŠ å…¥å¤šä¸ªå­ View</title>
      <link href="/2014/09/29/%E5%9C%A8%20SwipeRefreshLayout%20%E4%B8%AD%E5%8A%A0%E5%85%A5%E5%A4%9A%E4%B8%AA%E5%AD%90%20View/"/>
      <url>/2014/09/29/%E5%9C%A8%20SwipeRefreshLayout%20%E4%B8%AD%E5%8A%A0%E5%85%A5%E5%A4%9A%E4%B8%AA%E5%AD%90%20View/</url>
      <content type="html"><![CDATA[<p>2017-02-23 æ›´æ–°ï¼šæ—§æ–‡æ¬è¿ã€‚</p><p>SwipeRefreshLayout æ˜¯ç”±å®˜æ–¹æä¾›çš„ä¸‹æ‹‰åˆ·æ–° Widgetã€‚æœ€ä½åœ¨ v4 ä¸­å¯ç”¨ã€‚æœ€è¿‘ä½¿ç”¨äº†ä¸€ä¸‹ï¼Œå‘ç°è™½ç„¶æ˜¯å®˜æ–¹å‡ºå“ï¼Œä½†ä¹Ÿè¿˜æ˜¯ä¸å¤Ÿç†æƒ³ã€‚</p><p>åŸå…ˆå°è¯•ä½¿ç”¨äº† Android L ä¸­æä¾›çš„æ–°æ”¯æŒåº“ RecyclerViewï¼Œå½¼æ­¤ä¹‹é—´çš„å…¼å®¹æ€§å°±ä¸å¤Ÿå¥½ã€‚ï¼ˆRecyclerView åœ¨é‚£æ˜¯ä¹Ÿæ˜¯æ–°åº“ï¼Œbug å¤šå¤šï¼Œç°åœ¨å½“ç„¶æ²¡æœ‰è¿™ç§æƒ…å†µäº†ã€‚ï¼‰</p><p>åæ¥å› ä¸ºéœ€è¦å®ç°æ»‘åŠ¨åˆ°åº•éƒ¨è‡ªåŠ¨åŠ è½½æ›´å¤šæ•°æ®çš„åŠŸèƒ½ï¼ŒæŠŠ RecyclerView æ¢å›äº† ListViewã€‚åœ¨æ‰“ç®—æ·»åŠ  <a href="https://github.com/makovkastar/FloatingActionButton" target="_blank" rel="external">FloatingActionButton</a> åœ¨åŒä¸€ç”»é¢ä¸Šæ—¶ï¼Œå‘ç° SwipeRefreshLayout ä¸å¤Ÿæ–¹ä¾¿ã€‚æ ¹æ® FloatingActionButton è¿™ä¸ªåº“çš„è¯´æ˜ï¼Œéœ€è¦å°† FloatingActionButton ä¸ ListView æ”¾åœ¨åŒä¸€ ViewGroup ä¸‹ã€‚</p><a id="more"></a><p>ä½†æ˜¯ SwipeRefreshLayout åªèƒ½æœ‰ä¸€ä¸ªå­è§†å›¾ï¼Œä¸ç„¶å°±ä¼šä¸¢å¼‚å¸¸ã€‚äºæ˜¯è‡ªç„¶å°±ä¼šåœ¨ SwipeRefreshLayout ä¸‹åŠ ä¸€ä¸ª ViewGroup åŒ…è£…ä¸€å±‚æ¥è§£å†³è¿™ä¸ªé—®é¢˜ã€‚è¿™æ ·ä¸€æ¥ï¼ŒæŠ›å‡ºå¼‚å¸¸çš„é—®é¢˜æ˜¯è§£å†³äº†ã€‚ä½†æ˜¯è¿è¡Œåå‘ç°ï¼ŒListView åªèƒ½ä¸Šæ»‘ï¼Œè€Œä¸èƒ½ä¸‹æ‹‰ã€‚ä¸€æ—¦ä¸‹æ‹‰ï¼Œå°±ä¼šè§¦å‘ SwipeRefreshLayout çš„ä¸‹æ‹‰åˆ·æ–°ã€‚</p><p>å¯æƒ³è€ŒçŸ¥ï¼Œè¿™æ˜¯åœ¨äº‹ä»¶æ´¾å‘ä¸Šå‡ºäº†é—®é¢˜ã€‚ä¸‹æ‹‰çš„äº‹ä»¶åœ¨é€šå¸¸æƒ…å†µä¸‹åº”è¯¥ç”± ListView æ¥è¿›è¡Œå¤„ç†ï¼›å½“ ListView æ»šåŠ¨ä½ç½®ä½äºé¡¶éƒ¨æ—¶ï¼Œå†ç”± SwipeRefreshLayout æ¥è¿›è¡Œå¤„ç†ã€‚è€Œç°åœ¨çš„æƒ…å†µæ˜¯ï¼Œæ‰€æœ‰ä¸‹æ‹‰æ‰‹åŠ¿å…¨éƒ½ç”± SwipeRefreshLayout å¤„ç†çš„ã€‚</p><p>æŸ¥é˜…å…³äºäº‹ä»¶æ´¾å‘çš„èµ„æ–™åï¼Œä¹Ÿæ²¡æœ‰æƒ³åˆ°æ¯”è¾ƒå¯è¡Œçš„è§£å†³æ–¹æ¡ˆã€‚æ¥ä¸‹æ¥å»æŸ¥çœ‹äº†ä¸€ä¸‹ SwipeRefreshLayout çš„æºç ï¼Œç»“æœä¸æ€ä¹ˆéº»çƒ¦çš„å°±è§£å†³äº†ã€‚</p><p>æ ¹æ®äº‹ä»¶æ´¾å‘çš„çŸ¥è¯†ï¼Œåœ¨ SwipeRefreshLayout ä¸­æ‰¾åˆ°ç›¸å…³çš„æ–¹æ³• <code>onInterceptTouchEvent(MotionEvent ev)</code> å’Œ <code>onTouchEvent(MotionEvent ev)</code>ã€‚æŸ¥çœ‹å®ƒä»¬çš„ä»£ç ï¼Œå‘ç°åœ¨onIntercreptTouchEventä¸­æœ‰è¿™ä¹ˆä¸€æ®µï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">if</span> (!isEnabled() || mReturningToStart || canChildScrollUp()) &#123;</div><div class="line">    <span class="comment">// Fail fast if we're not in a state where a swipe is possible</span></div><div class="line">    <span class="keyword">return</span> <span class="keyword">false</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure><p>æ˜¾ç„¶ï¼Œ<code>canChildSrollUp()</code> æ–¹æ³•è·Ÿæˆ‘çš„é—®é¢˜æœ‰å¯†åˆ‡å…³è”ã€‚å†è¿½çœ‹ <code>canChildSrollUp()</code>ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line"><span class="comment">/**</span></div><div class="line"> * <span class="doctag">@return</span> Whether it is possible for the child view of this layout to</div><div class="line"> *         scroll up. Override this if the child view is a custom view.</div><div class="line"> */</div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">canChildScrollUp</span><span class="params">()</span> </span>&#123;</div><div class="line">    <span class="keyword">if</span> (android.os.Build.VERSION.SDK_INT &lt; <span class="number">14</span>) &#123;</div><div class="line">        <span class="keyword">if</span> (mTarget <span class="keyword">instanceof</span> AbsListView) &#123;</div><div class="line">            <span class="keyword">final</span> AbsListView absListView = (AbsListView) mTarget;</div><div class="line">            <span class="keyword">return</span> absListView.getChildCount() &gt; <span class="number">0</span></div><div class="line">                    &amp;&amp; (absListView.getFirstVisiblePosition() &gt; <span class="number">0</span> || absListView.getChildAt(<span class="number">0</span>)</div><div class="line">                            .getTop() &lt; absListView.getPaddingTop());</div><div class="line">        &#125; <span class="keyword">else</span> &#123;</div><div class="line">            <span class="keyword">return</span> mTarget.getScrollY() &gt; <span class="number">0</span>;</div><div class="line">        &#125;</div><div class="line">    &#125; <span class="keyword">else</span> &#123;</div><div class="line">        <span class="keyword">return</span> ViewCompat.canScrollVertically(mTarget, -<span class="number">1</span>);</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure><p>æ³¨é‡Šä¸­ä¹Ÿè¯´äº†ï¼Œå¦‚æœå­è§†å›¾æ˜¯è‡ªå®šä¹‰çš„ï¼Œé‚£ä¹ˆé‡å†™è¿™ä¸ªæ–¹æ³•å³å¯ã€‚mTarget å°±æ˜¯ SwipeRefreshLayout ä¸­é»˜è®¤çš„å”¯ä¸€çš„å­è§†å›¾ã€‚ç°åœ¨æ ¹æ®æˆ‘çš„è¦æ±‚ï¼Œç»§æ‰¿ SwipeRefreshLayout åï¼Œå°†è¿™ä¸ªæ–¹æ³•æ”¹ä¸ºå¦‚ä¸‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@Override</span></div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">canChildScrollUp</span><span class="params">()</span> </span>&#123;</div><div class="line">    <span class="keyword">if</span> (android.os.Build.VERSION.SDK_INT &lt; <span class="number">14</span>) &#123;</div><div class="line">        <span class="keyword">if</span> (mScrollableChild <span class="keyword">instanceof</span> AbsListView) &#123;</div><div class="line">            <span class="keyword">final</span> AbsListView absListView = (AbsListView) mScrollableChild;</div><div class="line">            <span class="keyword">return</span> absListView.getChildCount() &gt; <span class="number">0</span></div><div class="line">                    &amp;&amp; (absListView.getFirstVisiblePosition() &gt; <span class="number">0</span> || absListView.getChildAt(<span class="number">0</span>)</div><div class="line">                    .getTop() &lt; absListView.getPaddingTop());</div><div class="line">        &#125; <span class="keyword">else</span> &#123;</div><div class="line">            <span class="keyword">return</span> mScrollableChild.getScrollY() &gt; <span class="number">0</span>;</div><div class="line">        &#125;</div><div class="line">    &#125; <span class="keyword">else</span> &#123;</div><div class="line">        <span class="keyword">return</span> ViewCompat.canScrollVertically(mScrollableChild, -<span class="number">1</span>);</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure><p>å…¶ä¸­ï¼Œ<code>mScrollableChild</code> æ˜¯ç”±è‡ªå·±å®šä¹‰çš„ï¼Œå¯ä»¥æ»šåŠ¨çš„ Viewã€‚</p><p>ç°åœ¨ï¼Œä¸‹æ‹‰æ»šåŠ¨çš„é—®é¢˜å·²ç»è§£å†³äº†ã€‚æ¥ä¸‹æ¥å°±æ˜¯è¦æ–¹ä¾¿åœ°æŒ‡å®šè¿™ä¸ª <code>mScrollableChild</code>ã€‚æˆ‘å¸Œæœ›åœ¨æˆ‘è‡ªå®šä¹‰çš„ SwipeRefreshLayout ä¸­ï¼Œç”¨ xml çš„å±æ€§æ¥æŒ‡å®šä¸€ä¸ªidï¼Œç„¶åå°†è¿™ä¸ªæŒ‡å®š id çš„ View åŠ è½½åˆ° <code>mScrollableChild</code> ä¸Šã€‚</p><p>åœ¨ values æ–‡ä»¶å¤¹ä¸­æ–°å»ºä¸€ä¸ª attrs.xmlï¼Œå†…å®¹å¦‚ä¸‹ï¼š</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">&lt;?xml version="1.0" encoding="utf-8"?&gt;</div><div class="line"><span class="tag">&lt;<span class="name">resources</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">declare-styleable</span> <span class="attr">name</span>=<span class="string">"ImprovedSwipeLayoutAttrs"</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">attr</span> <span class="attr">name</span>=<span class="string">"scrollableChildId"</span> <span class="attr">format</span>=<span class="string">"reference"</span> /&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">declare-styleable</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">resources</span>&gt;</span></div></pre></td></tr></table></figure><p>äºæ˜¯å°±å¯ä»¥å¦‚ä¸‹ä»£ç ä¸€æ ·ä½¿ç”¨äº†ï¼š</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">in.nerd_is.inactive_weibo.ui.ImprovedSwipeLayout</span></span></div><div class="line">    <span class="attr">xmlns:android</span>=<span class="string">"http://schemas.android.com/apk/res/android"</span></div><div class="line">    <span class="attr">xmlns:tools</span>=<span class="string">"http://schemas.android.com/tools"</span></div><div class="line">    <span class="attr">xmlns:fab</span>=<span class="string">"http://schemas.android.com/apk/res-auto"</span></div><div class="line">    <span class="attr">xmlns:isl</span>=<span class="string">"http://schemas.android.com/apk/res-auto"</span></div><div class="line">    <span class="attr">android:id</span>=<span class="string">"@+id/swipe_container"</span></div><div class="line">    <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></div><div class="line">    <span class="attr">android:layout_height</span>=<span class="string">"match_parent"</span></div><div class="line">    <span class="attr">android:background</span>=<span class="string">"@color/md_blue_grey_50"</span></div><div class="line">    <span class="attr">isl:scrollableChildId</span>=<span class="string">"@+id/list_statuses"</span></div><div class="line">    <span class="attr">tools:context</span>=<span class="string">"in.nerd_is.inactive_weibo.ui.StatusesFragment"</span> &gt;</div><div class="line"> </div><div class="line">    <span class="tag">&lt;<span class="name">FrameLayout</span></span></div><div class="line">        <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></div><div class="line">        <span class="attr">android:layout_height</span>=<span class="string">"match_parent"</span>&gt;</div><div class="line"> </div><div class="line">        <span class="tag">&lt;<span class="name">ListView</span></span></div><div class="line">            <span class="attr">android:id</span>=<span class="string">"@+id/list_statuses"</span></div><div class="line">            <span class="attr">android:minHeight</span>=<span class="string">"?android:attr/listPreferredItemHeight"</span></div><div class="line">            <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></div><div class="line">            <span class="attr">android:layout_height</span>=<span class="string">"match_parent"</span></div><div class="line">            <span class="attr">android:paddingTop</span>=<span class="string">"12dp"</span></div><div class="line">            <span class="attr">android:paddingBottom</span>=<span class="string">"12dp"</span></div><div class="line">            <span class="attr">android:paddingLeft</span>=<span class="string">"8dp"</span></div><div class="line">            <span class="attr">android:paddingRight</span>=<span class="string">"8dp"</span></div><div class="line">            <span class="attr">android:clipToPadding</span>=<span class="string">"false"</span></div><div class="line">            <span class="attr">android:divider</span>=<span class="string">"@android:color/transparent"</span></div><div class="line">            <span class="attr">android:dividerHeight</span>=<span class="string">"12dp"</span>/&gt;</div><div class="line"> </div><div class="line">        <span class="tag">&lt;<span class="name">com.melnykov.fab.FloatingActionButton</span></span></div><div class="line">            <span class="attr">android:id</span>=<span class="string">"@+id/button_floating_action"</span></div><div class="line">            <span class="attr">android:layout_width</span>=<span class="string">"wrap_content"</span></div><div class="line">            <span class="attr">android:layout_height</span>=<span class="string">"wrap_content"</span></div><div class="line">            <span class="attr">android:layout_gravity</span>=<span class="string">"bottom|right"</span></div><div class="line">            <span class="attr">android:layout_margin</span>=<span class="string">"16dp"</span></div><div class="line">            <span class="attr">android:src</span>=<span class="string">"@drawable/ic_md_create"</span></div><div class="line">            <span class="attr">fab:fab_colorNormal</span>=<span class="string">"@color/md_blue_400"</span></div><div class="line">            <span class="attr">fab:fab_colorPressed</span>=<span class="string">"@color/md_blue_grey_500"</span>/&gt;</div><div class="line">    <span class="tag">&lt;/<span class="name">FrameLayout</span>&gt;</span></div><div class="line"> </div><div class="line"><span class="tag">&lt;/<span class="name">in.nerd_is.inactive_weibo.ui.ImprovedSwipeLayout</span>&gt;</span></div></pre></td></tr></table></figure><p>ImprovedSwipeLayout å…¨éƒ¨ä»£ç å¦‚ä¸‹ï¼Œå¾ˆç®€å•ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ImprovedSwipeLayout</span> <span class="keyword">extends</span> <span class="title">SwipeRefreshLayout</span> </span>&#123;</div><div class="line"></div><div class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String TAG = ImprovedSwipeLayout.class.getCanonicalName();</div><div class="line">    <span class="keyword">private</span> <span class="keyword">int</span> mScrollableChildId;</div><div class="line">    <span class="keyword">private</span> View mScrollableChild;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="title">ImprovedSwipeLayout</span><span class="params">(Context context)</span> </span>&#123;</div><div class="line">        <span class="keyword">this</span>(context, <span class="keyword">null</span>);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="title">ImprovedSwipeLayout</span><span class="params">(Context context, AttributeSet attrs)</span> </span>&#123;</div><div class="line">        <span class="keyword">super</span>(context, attrs);</div><div class="line"></div><div class="line">        TypedArray a = context.obtainStyledAttributes(</div><div class="line">                attrs, R.styleable.ImprovedSwipeLayoutAttrs);</div><div class="line">        mScrollableChildId = a.getResourceId(R.styleable.ImprovedSwipeLayoutAttrs_scrollableChildId, <span class="number">0</span>);</div><div class="line">        mScrollableChild = findViewById(mScrollableChildId);</div><div class="line">        a.recycle();</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">canChildScrollUp</span><span class="params">()</span> </span>&#123;</div><div class="line">        ensureScrollableChild();</div><div class="line"></div><div class="line">        <span class="keyword">if</span> (android.os.Build.VERSION.SDK_INT &lt; <span class="number">14</span>) &#123;</div><div class="line">            <span class="keyword">if</span> (mScrollableChild <span class="keyword">instanceof</span> AbsListView) &#123;</div><div class="line">                <span class="keyword">final</span> AbsListView absListView = (AbsListView) mScrollableChild;</div><div class="line">                <span class="keyword">return</span> absListView.getChildCount() &gt; <span class="number">0</span></div><div class="line">                        &amp;&amp; (absListView.getFirstVisiblePosition() &gt; <span class="number">0</span> || absListView.getChildAt(<span class="number">0</span>)</div><div class="line">                        .getTop() &lt; absListView.getPaddingTop());</div><div class="line">            &#125; <span class="keyword">else</span> &#123;</div><div class="line">                <span class="keyword">return</span> mScrollableChild.getScrollY() &gt; <span class="number">0</span>;</div><div class="line">            &#125;</div><div class="line">        &#125; <span class="keyword">else</span> &#123;</div><div class="line">            <span class="keyword">return</span> ViewCompat.canScrollVertically(mScrollableChild, -<span class="number">1</span>);</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">ensureScrollableChild</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">if</span> (mScrollableChild == <span class="keyword">null</span>) &#123;</div><div class="line">            mScrollableChild = findViewById(mScrollableChildId);</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">&#125;</div></pre></td></tr></table></figure>]]></content>
      
      
        <tags>
            
            <tag> Android </tag>
            
            <tag> View </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>Android ä¸­çš„ Task å’Œ  Back stack</title>
      <link href="/2013/08/19/Android-%E4%B8%AD%E7%9A%84-Task-%E5%92%8C-Back-stack/"/>
      <url>/2013/08/19/Android-%E4%B8%AD%E7%9A%84-Task-%E5%92%8C-Back-stack/</url>
      <content type="html"><![CDATA[<p>2017-02-20 æ›´æ–°ï¼šæ—§æ–‡æ¬è¿ã€‚å†…å®¹å¾ˆæµ…æ˜¾ï¼Œä½†è¿™éƒ¨åˆ†å†…å®¹å®é™…ä¸Šæ˜¯éœ€è¦å¥½å¥½æŒæ¡çš„ï¼Œç­‰ä»¥åä¼šå†å……å®ä¸€ä¸‹ã€‚</p><p>åœ¨è¿‘æ¥åšçš„å®æˆ˜é¡¹ç›®ä¸­ï¼Œç»ˆäºæ¶‰åŠåˆ°äº†è¿™ä¸ªæ–¹é¢çš„å†…å®¹ï¼Œé‚£å°±è¶æœºå­¦ä¸€å­¦ç”¨ä¸€ç”¨ã€‚</p><p>äº‹å®ä¸Šï¼Œè¿™æ–¹é¢çš„å†…å®¹å¹¶ä¸éš¾ç†è§£ï¼Œä½†æ˜¯æ€»è®©æˆ‘æ„Ÿè§‰ä¸çŸ¥è¯¥æ€ä¹ˆç”¨æ‰å¥½ã€‚è¿™é‡Œä¹Ÿå°±åªèƒ½åˆ—ä¸€åˆ—å‡ ç§æ¨¡å¼ï¼Œè‡³äºç›¸åº”çš„è§£å†³æ–¹æ³•ï¼Œè¿˜æ˜¯éœ€è¦è‡ªå·±å»ç¢ç£¨è¯•éªŒã€‚</p><a id="more"></a><p>ä¸‹é¢çš„å†…å®¹å‚è€ƒï¼Œéƒ½æ˜¯æ¥è‡ªå®˜æ–¹æ–‡æ¡£ã€‚</p><p>Task æ˜¯ç”¨æˆ·åœ¨è¿›è¡Œç‰¹å®šæ“ä½œæ—¶è°ƒç”¨çš„ activity çš„ä¸€ä¸ªé›†åˆã€‚è¿™äº› activity æ˜¯ç”±å›é€€æ ˆï¼ˆback stackï¼‰æ¥è¿›è¡Œç®¡ç†çš„ï¼Œä»¥æ‰“å¼€çš„é¡ºåºæ¥è¿›è¡Œæ’åˆ—ã€‚</p><p>Home screen æ˜¯å¤§å¤šæ•° task å¼€å§‹çš„åœ°æ–¹ã€‚å½“ç”¨æˆ·åœ¨ç‚¹å‡»åº”ç”¨çš„å›¾æ ‡æ—¶ï¼Œè¯¥åº”ç”¨çš„ task å°±æ¥åˆ°äº†å‰å°ï¼›å¦‚æœè¿˜æ²¡æœ‰å®ƒçš„ taskï¼Œåˆ™ä¼šæ–°å»ºä¸€ä¸ªã€‚æ‰“å¼€çš„ activity åˆ™ä¼šè¢«æ”¾åœ¨è¿™ä¸ª stack æœ€åº•éƒ¨ï¼ˆäº‹å®ä¸Šä¹Ÿæ˜¯åœ¨å›é€€æ ˆçš„æœ€é¡¶éƒ¨ï¼Œå› ä¸ºæ ˆå†…åªæœ‰è¿™ä¹ˆä¸€ä¸ªå…ƒç´ ï¼‰ã€‚</p><p>å½“åœ¨æ ˆå†…çš„è¿™ä¸ª activity æ‰“å¼€å…¶ä»–çš„ activity æ—¶ï¼Œæ–°çš„ activity ä¼šè¢«è¢«æ”¾ç½®åœ¨æ ˆçš„é¡¶éƒ¨ï¼Œå¹¶ä¸”å¾—åˆ°ç„¦ç‚¹ã€‚ç”¨æˆ·ç‚¹å‡»è¿”å›é”®åï¼Œå½“å‰çš„ activity è¢«é”€æ¯ï¼ŒåŒæ—¶ä¹Ÿä»æ ˆä¸­è¢«å¼¹å‡ºï¼Œæ­¤æ—¶åœ¨æ ˆé¡¶çš„ activity è¢«æ¢å¤ã€‚åœ¨å›é€€æ ˆä¸­çš„ activity æ˜¯ä¸å¯èƒ½è¿›è¡Œé‡æ–°æ’åºçš„ï¼Œåªæœ‰æ ˆçš„ push å’Œ pop æ“ä½œï¼ˆLIFOï¼‰ã€‚</p><p>ç»§ç»­æŒ‰è¿”å›é”®ï¼Œtask ä¸­çš„ activity å°†ä¼šä¾æ¬¡è¢«å¼¹å‡ºï¼Œç›´åˆ°å…¶ä¸­å†æ²¡æœ‰ activityï¼Œè¿™æ—¶ï¼Œè¿™ä¸ª task ä¹Ÿå°±ä¸å­˜åœ¨äº†ã€‚</p><p>ç”¨æˆ·å¼€å§‹ä¸€ä¸ªæ–°çš„ task æ—¶ï¼ŒåŸæ¥çš„ task å¯ä»¥è¢«ç§»åˆ°åå°ï¼Œå…¶ä¸­çš„æ‰€æœ‰ activity éƒ½ä¼šåœæ­¢ï¼Œä½†å›é€€æ ˆä¿æŒå®Œæ•´ã€‚å¹¶ä¸”ç”¨æˆ·æ­¤æ—¶å¯ä»¥å›åˆ°åŸæ¥çš„ taskï¼Œæ¯”å¦‚é€šè¿‡é€‰æ‹©æœ€è¿‘åº”ç”¨ï¼Œæˆ–è€…æ˜¯åœ¨ä¸»é¡µå†æ¬¡ç‚¹å‡»å¼€å§‹é‚£ä¸ªåº”ç”¨ã€‚</p><p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå½“è¿è¡Œäº†å¤ªå¤šçš„ task æ—¶ï¼Œç³»ç»Ÿä¼šå¼€å§‹é”€æ¯åå°çš„ activityã€‚è¢«é”€æ¯çš„ activity çš„çŠ¶æ€å°†ä¼šä¸¢å¤±ï¼Œä½†æ˜¯ task çš„å›é€€æ ˆä¸ä¼šä¸¢å¤±ã€‚</p><p>å¦‚æœä¸€ä¸ª activity èƒ½åœ¨å¤šä¸ª activity ä¸­è¢«æ‰“å¼€ï¼Œç”±äºå›é€€æ ˆä¸èƒ½è¢«é‡æ–°æ’åºï¼Œæ­¤æ—¶è¿™ä¸ªå›é€€æ ˆä¸­ä¼šå‡ºç°è¿™ä¸ª activity çš„å¤šä¸ªå®ä¾‹ï¼Œç”šè‡³åœ¨å¤šä¸ª task ä¸­è¢«å®ä¾‹åŒ–å¤šæ¬¡ã€‚è¿™æ—¶å€™å†ç‚¹å‡»è¿”å›é”®ï¼Œè¿˜æ˜¯ä¾æ—§å°†è¿™äº› activity ä¾æ¬¡å¼¹å‡ºï¼Œå¹¶ä¸”å„è‡ªæœ‰å„è‡ªçš„çŠ¶æ€ã€‚å¦‚æœä¸æƒ³ activity è¢«å®ä¾‹åŒ–å¤šæ¬¡ï¼Œå¯ä»¥å¯¹è¿™ç§è¡Œä¸ºè¿›è¡Œæ›´æ”¹ã€‚</p><h2 id="å®šä¹‰å¯åŠ¨æ¨¡å¼"><a href="#å®šä¹‰å¯åŠ¨æ¨¡å¼" class="headerlink" title="å®šä¹‰å¯åŠ¨æ¨¡å¼"></a>å®šä¹‰å¯åŠ¨æ¨¡å¼</h2><p>å¯åŠ¨æ¨¡å¼å…è®¸ä½ å®šä¹‰æ–°çš„ activity å®ä¾‹ä¸å½“å‰ task çš„å…³ç³»ã€‚æœ‰ä¸¤ç§å®šä¹‰æ–¹æ³•ï¼š</p><ol><li>ä½¿ç”¨ manifest æ–‡ä»¶</li><li>ä½¿ç”¨ Intent çš„ flags</li></ol><p><code>&lt;activity&gt;</code> ä¸­å¯ä½¿ç”¨çš„å±æ€§ï¼š</p><ul><li>taskAffinity</li><li>launchMode</li><li>allowTaskReparenting</li><li>clearTaskOnLaunch</li><li>alwaysRetainTaskState</li><li>finishOnTaskLaunch</li></ul><p>flags å¯ä½¿ç”¨çš„å€¼ï¼š</p><ul><li>FLAG_ACTIVITY_NEW_TASK</li><li>FLAG_ACTIVITY_CLEAR_TOP</li><li>FLAG_ACTIVITY_SINGLE_TOP</li></ul><p>Intent çš„ flags æ–¹å¼ä¼˜å…ˆäº manifestï¼Œä½†æ˜¯ï¼Œä¸¤ä¸ªæ–¹å¼ä¸èƒ½ç­‰åŒã€‚æŸäº›æ•ˆæœåªèƒ½é€šè¿‡åœ¨ manifest ä¸­å®šä¹‰çš„å¯åŠ¨æ¨¡å¼å®ç°ï¼Œä¸èƒ½é€šè¿‡ flags å®ç°ï¼›åä¹‹äº¦ç„¶ã€‚</p><h3 id="ä½¿ç”¨-manifest-æ–‡ä»¶"><a href="#ä½¿ç”¨-manifest-æ–‡ä»¶" class="headerlink" title="ä½¿ç”¨ manifest æ–‡ä»¶"></a>ä½¿ç”¨ manifest æ–‡ä»¶</h3><p>ä½¿ç”¨ <code>&lt;activity&gt;</code> å…ƒç´ ä¸­çš„ launchMode å±æ€§ã€‚launchMode å±æ€§å¯è®¾ä¸ºå››ç§å¯åŠ¨æ¨¡å¼ï¼š</p><ul><li>standard<br>é»˜è®¤å€¼ã€‚ç³»ç»Ÿåœ¨å¯åŠ¨ activity çš„ task ä¸­åˆ›å»ºä¸€ä¸ªæ–°çš„ activity å®ä¾‹ï¼Œå¹¶ä¸”å°† intent ä¼ é€ç»™å®ƒã€‚è¯¥ activity å¯ä»¥è¢«å®ä¾‹åŒ–å¤šæ¬¡ï¼Œå„ä¸ªå®ä¾‹å¯ä»¥å±äºä¸åŒçš„ taskï¼Œä¸€ä¸ª task ä¸­ä¹Ÿå¯ä»¥å­˜åœ¨å¤šä¸ªå®ä¾‹ã€‚</li><li>singleTop<br>å¦‚æœ activity å·²ç»å­˜åœ¨ä¸€ä¸ªå®ä¾‹å¹¶ä½äºå½“å‰ task çš„æ ˆé¡¶ï¼Œåˆ™ç³»ç»Ÿä¼šè°ƒç”¨å·²æœ‰å®ä¾‹çš„ <code>onNewIntent()</code> æ–¹æ³•æŠŠ intent ä¼ é€’ç»™å·²æœ‰å®ä¾‹ï¼Œè€Œä¸æ˜¯åˆ›å»ºä¸€ä¸ªæ–°çš„å®ä¾‹ã€‚activity å¯ä»¥è¢«å®ä¾‹åŒ–å¤šæ¬¡ï¼Œå„ä¸ªå®ä¾‹å¯ä»¥å±äºä¸åŒçš„ taskï¼Œä¸€ä¸ª task ä¸­å¯ä»¥å­˜åœ¨å¤šä¸ªå®ä¾‹ï¼ˆä½†ä»…å½“æ ˆé¡¶çš„å®ä¾‹ä¸æ˜¯è¯¥ activity çš„ï¼‰ã€‚</li><li>singleTask<br>ç³»ç»Ÿå°†åˆ›å»ºä¸€ä¸ªæ–°çš„ taskï¼Œå¹¶æŠŠ activity å®ä¾‹ä½œä¸ºæ ¹æ”¾å…¥å…¶ä¸­ã€‚ä½†æ˜¯ï¼Œå¦‚æœ activity å·²ç»åœ¨å…¶å®ƒ task ä¸­å­˜åœ¨å®ä¾‹ï¼Œåˆ™ç³»ç»Ÿä¼šé€šè¿‡è°ƒç”¨å…¶å®ä¾‹çš„ <code>onNewIntent()</code> æ–¹æ³•æŠŠ intent ä¼ ç»™å·²æœ‰å®ä¾‹ï¼Œè€Œä¸æ˜¯å†åˆ›å»ºä¸€ä¸ªæ–°å®ä¾‹ã€‚ æ­¤ activity åŒä¸€æ—¶åˆ»åªèƒ½å­˜åœ¨ä¸€ä¸ªå®ä¾‹ã€‚</li><li>singleInstance<br>é™¤äº†ç³»ç»Ÿä¸ä¼šæŠŠå…¶å®ƒ activity æ”¾å…¥å½“å‰å®ä¾‹æ‰€åœ¨çš„ task ä¹‹å¤–ï¼Œå…¶å®ƒå‡ä¸ singleTask ç›¸åŒã€‚ æ— è®º activity æ˜¯åœ¨ä¸€ä¸ªæ–°çš„ task ä¸­å¯åŠ¨ï¼Œè¿˜æ˜¯ä½äºå…¶å®ƒå·²æœ‰çš„ task ä¸­ï¼Œç”¨æˆ·æ€»æ˜¯å¯ä»¥ç”¨å›é€€é”®è¿”å›åˆ°å‰ä¸€ä¸ª activity ä¸­ã€‚ ä½†æ˜¯ï¼Œå¦‚æœä½ å¯åŠ¨äº†ä¸€ä¸ªå¯åŠ¨æ¨¡å¼è®¾ä¸ºsingleTaskçš„ activityï¼Œä¸”æœ‰ä¸€ä¸ªåå° task ä¸­å·²å­˜åœ¨å®ä¾‹çš„è¯ï¼Œåˆ™è¿™ä¸ªåå° task å°±ä¼šæ•´ä¸ªè½¬åˆ°å‰å°ã€‚ è¿™æ—¶ï¼Œå½“å‰çš„å›é€€æ ˆå°±åŒ…å«äº†è¿™ä¸ªè½¬å…¥å‰å°çš„ task ä¸­æ‰€æœ‰çš„ activityï¼Œä½ç½®æ˜¯åœ¨æ ˆé¡¶ã€‚</li></ul><h3 id="ä½¿ç”¨Intentæ ‡å¿—"><a href="#ä½¿ç”¨Intentæ ‡å¿—" class="headerlink" title="ä½¿ç”¨Intentæ ‡å¿—"></a>ä½¿ç”¨Intentæ ‡å¿—</h3><p>è¿™ä¸ªæ ‡å¿—å¯ä»¥ä¿®æ”¹çš„é»˜è®¤æ¨¡å¼åŒ…æ‹¬ï¼š</p><ul><li>FLAG_ACTIVITY_NEW_TASK<br>åœ¨æ–°çš„ task ä¸­å¯åŠ¨ activityã€‚å¦‚æœè¦å¯åŠ¨çš„ activity å·²ç»è¿è¡ŒäºæŸ task ä¸­ï¼Œåˆ™é‚£ä¸ª task å°†è°ƒå…¥å‰å°ï¼Œæœ€åä¿å­˜çš„çŠ¶æ€ä¹Ÿå°†æ¢å¤ï¼Œactivity å°†åœ¨ <code>onNewIntent()</code> ä¸­æ¥æ”¶åˆ°è¿™ä¸ªæ–° intentã€‚ è¿™ä¸ªè¿‡ç¨‹ä¸å‰ä¸€èŠ‚æ‰€è¿°çš„  singleTask æ¨¡å¼ç›¸åŒã€‚</li><li>FLAG_ACTIVITY_SINGLE_TOP<br>å¦‚æœè¦å¯åŠ¨çš„ activity å°±æ˜¯å½“å‰ activityï¼ˆä½äºå›é€€æ ˆé¡¶ï¼‰ï¼Œåˆ™å·²å­˜åœ¨çš„å®ä¾‹å°†æ¥æ”¶åˆ°ä¸€ä¸ª <code>onNewIntent()</code> è°ƒç”¨ï¼Œè€Œä¸æ˜¯åˆ›å»ºä¸€ä¸ª activity çš„æ–°å®ä¾‹ã€‚ è¿™ä¸ªè¿‡ç¨‹ä¸å‰ä¸€èŠ‚æ‰€è¿°çš„ singleTop æ¨¡å¼ç›¸åŒã€‚</li><li>FLAG_ACTIVITY_CLEAR_TOP<br>å¦‚æœè¦å¯åŠ¨çš„ activity å·²ç»åœ¨å½“å‰ task ä¸­è¿è¡Œï¼Œåˆ™ä¸å†å¯åŠ¨ä¸€ä¸ªæ–°çš„å®ä¾‹ï¼Œä¸”æ‰€æœ‰åœ¨å…¶ä¸Šé¢çš„ activity å°†è¢«é”€æ¯ï¼Œç„¶åé€šè¿‡ <code>onNewIntent()</code> ä¼ å…¥ intent å¹¶æ¢å¤ activityï¼ˆä¸åœ¨æ ˆé¡¶ï¼‰çš„è¿è¡Œã€‚ æ­¤ç§æ¨¡å¼åœ¨launchModeä¸­æ²¡æœ‰å¯¹åº”çš„å±æ€§å€¼ã€‚FLAG_ACTIVITY_CLEAR_TOP å¸¸ä¸ FLAG_ACTIVITY_NEW_TASK ä¸€èµ·ä½¿ç”¨ã€‚è¿™è¡¨ç¤ºå…ˆå®šä½å…¶å®ƒ task ä¸­å·²å­˜åœ¨çš„ activityï¼Œå†æŠŠå®ƒæ”¾å…¥å¯ä»¥å“åº” intent çš„ä½ç½®ã€‚</li></ul>]]></content>
      
      
        <tags>
            
            <tag> Android </tag>
            
            <tag> Task </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>ä½¿ç”¨ EasyBCD å¼•å¯¼ CentOS</title>
      <link href="/2013/03/09/%E4%BD%BF%E7%94%A8-EasyBCD-%E5%BC%95%E5%AF%BC-CentOS/"/>
      <url>/2013/03/09/%E4%BD%BF%E7%94%A8-EasyBCD-%E5%BC%95%E5%AF%BC-CentOS/</url>
      <content type="html"><![CDATA[<p>2017-02-20 æ›´æ–°ï¼šæ—§æ–‡æ¬è¿ã€ä¿®ç¼®ã€‚æˆ‘è®°å¾— Win8 å¼€å§‹ï¼Œä½¿ç”¨äº†æ¯”è¾ƒæ£˜æ‰‹çš„å¼•å¯¼ç³»ç»Ÿï¼Œä¸çŸ¥ç°åœ¨è¿™æ–¹æ³•æ˜¯å¦è¿˜æœ‰æ•ˆã€‚</p><p>æ˜¨æ™šé‡å¯åå¿½ç„¶è¿›ä¸äº† Windowsï¼Œå„ç§æœç´¢åŠ å„ç§å°è¯•åä¾æ—§æ— æœï¼Œä¸å¾—å·²åªèƒ½ä½¿ç”¨ PE ä¿®å¤ MBR çš„å¼•å¯¼ã€‚</p><p>è¿™ä¸ªåŠæ³•æ˜¯æˆ‘å°½åŠ›é¿å…çš„ï¼Œå› ä¸ºä¿®å¤åä¼šæŠŠ GRUB è¦†ç›–æ‰ï¼Œé‚£ä¹ˆæˆ‘å°±æ— æ³•è¿›å…¥ Linux ç³»ç»Ÿäº†ã€‚è¿™ä¹‹åä¿®å¤ Linux çš„å¼•å¯¼åˆæ˜¯ä¸€ç•ªé¢å¤–åŠŸå¤«ã€‚ä»¥å‰ä¹Ÿç®—æ˜¯ç¢°è§è¿‡ç±»ä¼¼çš„é—®é¢˜ï¼Œå½“æ—¶ç”¨äº† EasyBCD è¿™ä¸ªè½¯ä»¶æ¥å¼•å¯¼ç³»ç»Ÿï¼Œæ‰€ä»¥è¿™ä¸€æ¬¡ä¹Ÿç«‹é©¬æƒ³åˆ°äº†è¿™ä¸ªè½¯ä»¶ã€‚ä¸è¿‡è¿˜æ˜¯ç¢°è§äº†ä¸å°‘é—®é¢˜ï¼Œä¸€ä¸Šåˆæ‰çœŸæ­£è§£å†³äº†è¿™ä¸ªé—®é¢˜ã€‚ç»éªŒéš¾å¾—ï¼Œéœ€è¦è®°å½•ä¸€ä¸‹ã€‚</p><a id="more"></a><p>ä»¥å‰ç”¨ EasyBCD çš„æ—¶å€™ï¼Œçº¯ç²¹æ˜¯ä¹±æŠ˜è…¾ï¼Œå¤šåŠ å‡ ä¸ªä¸åŒçš„å¼•å¯¼ï¼Œç›´ç™½åœ°ç¢°è¿æ°”ï¼Œé—®é¢˜ä¹Ÿè§£å†³äº†ã€‚ä½†è¿™ä¸€æ¬¡æ²¡æœ‰è¿™ä¹ˆå¥½çš„äººå“ã€‚è¿™æ¬¡å®‰è£…ç³»ç»Ÿçš„æ—¶å€™æŠŠ /boot å•ç‹¬æŒ‚è½½åˆ°ä¸€ä¸ªåˆ†åŒºä¸Šï¼ŒçŒœæµ‹è¿™å°±æ˜¯ä»¥å‰çš„æ–¹æ³•ä¸å¥æ•ˆçš„åŸå› ã€‚</p><p>ç»è¿‡è¿™ä¸€æ¬¡çš„æŠ˜è…¾ï¼Œå¯¹ç³»ç»Ÿçš„å¼•å¯¼ç®—æ˜¯å¤šäº†ä¸€äº›ç†è§£ã€‚å…¶ä¸­å„ç§æ›²æŠ˜ï¼Œå„ç§é‡å¯ï¼Œå†™ä¸€ä¸‹æ­£ç¡®çš„è§£å†³åŠæ³•ã€‚</p><p>å‚è€ƒæ–‡çŒ®æœ‰ï¼š<a href="http://wenku.baidu.com/view/2367b2d926fff705cc170a48.html" title="ç™¾åº¦æ–‡åº“èµ„æ–™" target="_blank" rel="external">ç™¾åº¦æ–‡åº“çš„ä¸€ç¯‡</a>ï¼ˆè¿™ä¸ªæ˜¯é‡ç‚¹ï¼‰ï¼Œ<a href="http://neosmart.net/wiki/display/EBCD/NeoGrub" title="EasyBCD å®˜æ–¹æ–‡æ¡£" target="_blank" rel="external">EasyBCD å®˜æ–¹æ–‡æ¡£</a>ï¼Œ<a href="http://baike.baidu.com/view/225343.htm" title="Grub ç™¾ç§‘" target="_blank" rel="external">GRUB çš„ç™¾åº¦ç™¾ç§‘</a>ã€‚</p><hr><p>å®‰è£…å¥½ EasyBCD åï¼Œæ·»åŠ å¼•å¯¼ï¼Œé€‰æ‹© NeoGrubï¼Œå®‰è£…ï¼Œé…ç½®ã€‚è¿™æ—¶å€™å‡ºç°ä½¿ç”¨è®°äº‹æœ¬æ‰“å¼€çš„ menu.lstï¼Œè¿™é‡Œè¦æ·»åŠ çš„å°±æ˜¯å…³é”®äº†ã€‚</p><p>é¦–å…ˆæ¥çœ‹çœ‹å®˜æ–¹ç»™å‡ºçš„Ubuntuå¼•å¯¼å®ä¾‹ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">titleUbuntu Gutsy Gibbon    </div><div class="line">root(hd1,2)    <span class="comment">#Load Ubuntu from the 2nd harddrive's 3rd partition.</span></div><div class="line"><span class="comment">#Next Line: Translate (hd1,2) to Linux notation and set that as the root partition</span></div><div class="line">kernel/boot/vmlinuz-2.6.22-14-generic root=/dev/sdbc</div><div class="line">initrd/boot/initrd.img-2.6.22-14-generic</div></pre></td></tr></table></figure><p>title æ˜¯å¼•å¯¼ç³»ç»Ÿçš„åå­—ï¼Œè‡ªå·±å†™ä¸€ä¸ªèƒ½è¾¨è®¤çš„å°±å¥½ã€‚</p><p>root è¿™ä¸€è¡Œæ˜¯è£…è½½æŒ‡å®šçš„åˆ†åŒºï¼Œå¦‚æœè£…è½½çš„åˆ†åŒºä¸æ­£ç¡®ï¼Œé‚£ä¹ˆä¸‹é¢æŒ‡å®šçš„æ–‡ä»¶è‡ªç„¶å°±ä¸èƒ½è¢«æ‰¾åˆ°ï¼Œå¼•å¯¼è‡ªç„¶å¤±è´¥ã€‚root åæœ‰ä¸€ä¸ªç©ºæ ¼ï¼Œæ‹¬å·å†…æ˜¯ç¬¬å‡ ä¸ªç¡¬ç›˜çš„ç¬¬å‡ ä¸ªåˆ†åŒºã€‚hd0 æ˜¯ç¬¬ä¸€å—ç¡¬ç›˜ï¼Œ0 æ˜¯è¿™ä¸€å—ç¡¬ç›˜çš„ç¬¬ä¸€ä¸ªåˆ†åŒºï¼Œä¾æ¬¡ç±»æ¨ã€‚è¿™é‡Œéœ€è¦è£…è½½çš„æ˜¯ /boot æ‰€åœ¨çš„åˆ†åŒºã€‚</p><p>kernel è¡ŒæŒ‡å®š Linux çš„å†…æ ¸ï¼Œä½ç½®åœ¨ /boot ä¸‹ï¼Œåå­—ä¸€èˆ¬æ˜¯ä»¥ vmlinuz å¼€å¤´çš„ä¸€ä¸ªæ–‡ä»¶ã€‚å¦‚æœ /boot æ˜¯å•ç‹¬æŒ‚è½½ï¼Œä½ç½®åº”è¯¥ç±»ä¼¼ï¼š<code>/vmlinuz-2.6.22-14-generic</code>ã€‚</p><p>å¦‚æœä¸çŸ¥é“å†…æ ¸çš„åç§°ï¼Œé‡å¯è¿›å…¥ NeoGrubï¼ŒæŒ‰ c è¿›å…¥å‘½ä»¤è¡Œæ¨¡å¼ï¼Œä½¿ç”¨ root å‘½ä»¤è£…è½½åˆ†åŒºåå¯ä»¥ä½¿ç”¨ TAB é”®åˆ—å‡ºæ–‡ä»¶æˆ–å‘½ä»¤ã€‚è¯·æ³¨æ„è¿™ä¸ªåŠŸèƒ½ï¼Œä¸‹é¢çš„ initrd æ–‡ä»¶ä¹Ÿéœ€è¦ä½¿ç”¨ç›¸åŒçš„æ–¹æ³•æ¥è·å¾—ã€‚å†…æ ¸åå­—åçš„ <code>root=***</code> å¿…ä¸å¯å°‘ï¼Œæˆ‘åœ¨è¿™é‡Œæ ½äº†å¾ˆä¹…ã€‚æœ‰ä¸€äº› Linux ä¸‹ç¡¬ç›˜ç›¸å…³çŸ¥è¯†çš„åº”è¯¥ä¸éš¾ç†è§£è¿™ä¸€å¥ã€‚ä¸æ˜¯å¾ˆæ¸…æ¥šçš„è¯·å‚è€ƒ<a href="http://vbird.dic.ksu.edu.tw/linux_basic/0130designlinux_2.php" title="é¸Ÿå“¥çš„ Linux ç§æˆ¿èœ" target="_blank" rel="external">é¸Ÿå“¥çš„ç›¸å…³å†…å®¹</a>ã€‚<code>/dev/sd??</code> è¿™ä¸ªå…¶å®æŒ‡çš„å°±æ˜¯æ ¹ç›®å½•/æ‰€åœ¨çš„åˆ†åŒºã€‚</p><p>initrd ä¹Ÿæ˜¯ä¸€ä¸ªæ–‡ä»¶ï¼Œä¸å†…æ ¸ vmlinuz åŒåœ¨ /boot ä¸‹ã€‚åç§°å¯èƒ½æ˜¯ initrd å¼€å¤´çš„ä¸€ä¸ªæ–‡ä»¶ï¼Œä½†ä¹Ÿå¯èƒ½æ˜¯ initramfs å¼€å¤´çš„ä¸€ä¸ª img æ–‡ä»¶ï¼Œåœ¨æˆ‘çš„ç³»ç»Ÿä¸Šå°±æ˜¯å¦‚æ­¤ã€‚</p><p>åœ¨è¿™ä¹‹åå¯èƒ½è¿˜éœ€è¦æ·»åŠ ä¸€å¥ boot å‘½ä»¤ã€‚</p><p>è¿™é‡Œè¯´æ˜ä¸€ä¸‹æˆ‘çš„è¯¯åŒºã€‚å› ä¸ºæˆ‘çš„ /boot æ˜¯å•ç‹¬æŒ‚è½½çš„ï¼Œæ‰€ä»¥ä¸èƒ½åŒæ—¶ç”¨ root å‘½ä»¤è£…è½½ <code>/</code> å’Œ <code>/boot</code>ã€‚è®©æˆ‘å¯¹æ€ä¹ˆæŒ‡å®š <code>root=</code> åçš„æ ¹ç›®å½•å¾ˆä¼¤è„‘ç­‹ã€‚åœ¨æˆ‘æŸ¥çœ‹ GRUB çš„ç™¾åº¦ç™¾ç§‘çš„æ—¶å€™ï¼Œå­¦ä¹ åˆ°åœ¨åŠ è½½äº†å†…æ ¸æ–‡ä»¶åï¼Œ/boot ç­‰å°±å·²ç»æŒ‚è½½åˆ°æ ¹ç›®å½•ä¸‹äº†ã€‚æ‰€ä»¥åªéœ€è¦ä½¿ç”¨<code>root=/dev/sd??</code> è¿™æ ·çš„å†™æ³•æ¥æŒ‡å®šå°±å¥½äº†ï¼Œè€Œä¸å¿…è€ƒè™‘è‡ªå·±åœ¨ GRUB ä¸­è£…è½½çš„æ˜¯å“ªä¸€ä¸ªåˆ†åŒºã€‚</p><p>ä¸‹é¢æ˜¯æˆ‘æˆåŠŸå¼•å¯¼çš„menu.lstæ–‡ä»¶ï¼Œä¾›å‚è€ƒï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># NeoSmart NeoGrub Bootloader Configuration File</span></div><div class="line"><span class="comment">#</span></div><div class="line"><span class="comment"># This is the NeoGrub configuration file, and should be located at C:\NST\menu.lst</span></div><div class="line"><span class="comment"># Please see the EasyBCD Documentation for information on how to create/modify entries:</span></div><div class="line"><span class="comment"># http://neosmart.net/wiki/display/EBCD/</span></div><div class="line"></div><div class="line">default 0</div><div class="line">timeout 8</div><div class="line"></div><div class="line">title CentOS 6.3</div><div class="line">    root (hd0,4)</div><div class="line">    kernel /vmlinuz-2.6.32-279.el6.x86_64 root=/dev/sda8</div><div class="line">    initrd /initramfs-2.6.32-279.el6.x86_64.img</div><div class="line">    boot</div></pre></td></tr></table></figure>]]></content>
      
      
        <tags>
            
            <tag> Linux </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>CentOS ä¸ Ubuntu ä¸‹å®‰è£… NVIDIA é©±åŠ¨</title>
      <link href="/2013/03/07/CentOS-%E4%B8%8E-Ubuntu-%E4%B8%8B%E5%AE%89%E8%A3%85-NVIDIA-%E9%A9%B1%E5%8A%A8/"/>
      <url>/2013/03/07/CentOS-%E4%B8%8E-Ubuntu-%E4%B8%8B%E5%AE%89%E8%A3%85-NVIDIA-%E9%A9%B1%E5%8A%A8/</url>
      <content type="html"><![CDATA[<p>2017-02-20 æ›´æ–°ï¼šæ—§æ–‡æ¬è¿ï¼Œç•¥åŠ ä¿®ç¼®ï¼Œè§‰å¾—è¿˜å®ç”¨ï¼Œæ‰€ä»¥ä¿ç•™ä¸‹æ¥ã€‚<br>2013-08-29 æ›´æ–°ï¼šUbuntu ä¸‹å®‰è£…æ–¹æ³•ï¼Œè¯¦è§æœ€ä¸‹ã€‚</p><p>NVIDIA é©±åŠ¨å®‰è£…çš„é‡ç‚¹åœ¨äºå…³é—­ç³»ç»Ÿæœ¬èº«é»˜è®¤è¿è¡Œçš„ nouveau æ¨¡å—ã€‚</p><p>é¦–å…ˆä¸Šå‚è€ƒæ–‡ç« å§ã€‚<a href="http://enetq.blog.51cto.com/479739/591622" target="_blank" rel="external">æ–‡ç« ä¸€</a>è¿˜æœ‰<a href="http://www.ideasr.com/thread-33171-1-1.html" target="_blank" rel="external">æ–‡ç« äºŒ</a>ã€‚ä¸¤ç¯‡æ–‡ç« çš„æ–¹æ³•ç•¥æœ‰ä¸åŒï¼Œæˆ‘ç»¼åˆäº†ä¸€ä¸‹ã€‚</p><a id="more"></a><p>å» Nvidia å®˜ç½‘ä¸‹è½½å¯¹åº”çš„æ˜¾å¡é©±åŠ¨ï¼Œæˆ‘ä¸‹è½½çš„é©±åŠ¨æ–‡ä»¶åä¸ºï¼šNVIDIA-Linux-x86_64-310.32.runã€‚</p><p>è¿™éƒ¨åˆ†æ“ä½œå¤§é‡ä½¿ç”¨ root æƒé™ï¼Œæ‰€ä»¥æœ€å¥½è¿˜æ˜¯ä½¿ç”¨ root èº«ä»½æ¥è¿›è¡Œã€‚</p><p>ç¬¬ä¸€æ­¥éœ€è¦å…³é—­ X Windowsï¼Œè¿è¡Œï¼š<code>init 3</code>ã€‚</p><p>å¦‚æœç°åœ¨è¿è¡Œé©±åŠ¨å®‰è£…ç¨‹åº <code>sh NVIDIA-Linux-x86_64-310.32.run</code>ï¼Œæœ‰å¯èƒ½ä¼šæç¤ºä½ ï¼š</p><blockquote><p>ERROR: The Nouveau kernel driver is currently in use by your system. This  driver is incompatible with the NVIDIA driver, and must be disabled  before proceeding.</p></blockquote><p>æ„æ€å°±æ˜¯ nouveau è¿™ä¸ªæ¨¡å—æ­£åœ¨è¿è¡Œä¸­ï¼Œè¯¥æ¨¡å—ä¸NVIDIAé©±åŠ¨ä¸å…¼å®¹ï¼Œå¿…é¡»è¦è¢«ç¦ç”¨æ‰å¯ä»¥è¿›è¡Œã€‚ä¸ºäº†ç¦ç”¨è¿™ä¸ªæ¨¡å—ï¼Œå¤§è´¹å‘¨æŠ˜ï¼Œæ‰¾äº†ä¸å°‘èµ„æ–™æ–‡ç« ï¼Œæ€»ç®—è¯•éªŒå‡ºæœ‰æ•ˆçš„æ–¹æ³•ã€‚</p><p>è¿‡ç¨‹ä¸­ä¹Ÿçœ‹è§ä¸€äº›ä¼ è¯´ï¼Œè¯´æ˜¯æŸäº› Linux å‘è¡Œç‰ˆæœ¬ç¦ç”¨è¯¥æ¨¡å—ä¹Ÿä¸ç®—éº»çƒ¦ï¼Œä½†æ˜¯ CentOS ä¼¼ä¹å¹¶ä¸åœ¨é‚£ä¸ªé˜µè¥é‡Œã€‚</p><p><strong>æ›´æ–°ï¼šæ·»åŠ  blacklist æˆ–è®¸æ²¡æœ‰ä»€ä¹ˆå½±å“ï¼Œå¯ä»¥é€‰æ‹©è·³è¿‡è¿™éƒ¨åˆ†ï¼Œç›´æ¥åˆ°ä¿®æ”¹ <code>/etc/grub.conf</code> æ–‡ä»¶éƒ¨åˆ†ã€‚</strong></p><p>ç¼–è¾‘ <code>/etc/modprobe.d/blacklist.conf</code>ï¼Œåœ¨æŸå¤„ï¼ˆä½†æ˜¯ä¸è¦é€‰åœ¨æ³¨é‡Šé‡Œï¼‰åŠ ä¸Š <code>blacklist nouveau</code>ã€‚</p><p>ç„¶åä¸‹é¢ä¸€æ­¥æˆ‘ä¼°è®¡å¯ä»¥é€‰åšï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">* å¤‡ä»½ the initramfs file</div><div class="line">mv /boot/initramfs-$(uname -r).img /boot/initramfs-$(uname -r).img.bak</div><div class="line">* é‡æ–°å»ºç«‹ the initramfs file</div><div class="line">dracut -v /boot/initramfs-$(uname -r).img $(uname -r)</div></pre></td></tr></table></figure><p>å¦‚æœä½ è¿è¡Œäº†ä¸Šé¢çš„ä¸¤å¥å‘½ä»¤ï¼Œé‚£è¯·è®°å¥½ä½ æ›¾ç»å¤‡ä»½è¿‡ initramfs è¿™ä¸ªæ–‡ä»¶ã€‚å¦‚æœä»¥åå‡ºé”™ï¼Œå¯ä»¥è¿˜åŸè¯•è¯•ã€‚</p><p>åœ¨ CentOS é‡Œä¼¼ä¹å¿…é¡»è¿˜éœ€è¦ä¸‹é¢è¿™ä¸€æ­¥ã€‚å› ä¸ºæˆ‘å•ç‹¬è¯•äº†ä¸Šé¢ä¸¤æ­¥åå¹¶æ²¡æœ‰æ•ˆæœã€‚</p><p>ç¼–è¾‘ <code>/etc/grub.conf</code> æ–‡ä»¶ï¼Œç¦æ­¢ nouveau KMS çš„ä½¿ç”¨ã€‚</p><p>åœ¨è¿™ä¸ªæ–‡ä»¶é‡Œæ‰¾åˆ°ç°åœ¨æ‰€åœ¨çš„ç³»ç»Ÿé¡¹ç›®ï¼Œåº”è¯¥å½¢å¦‚ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">title CentOS (2.6.32-279.el6.x86_64)</div><div class="line">        root (hd0,4)</div><div class="line">        kernel /vmlinuz-2.6.32-279.el6.x86_64 ro root=UUID=55151a0d-b460-462b-b5c6-97dfd4a3d328 rd_NO_LUKS  KEYBOARDTYPE=pc KEYTABLE=us rd_NO_MD LANG=zh_CN.UTF-8 rd_NO_LVM rd_NO_DM rhgb quiet</div><div class="line">        initrd /initramfs-2.6.32-279.el6.x86_64.img</div></pre></td></tr></table></figure><p>åœ¨ kernel è¡Œçš„æœ€ååŠ ä¸Š <code>nouveau.modeset=0</code>ã€‚åŠ ä¸Šåçš„æ–‡ä»¶åº”è¯¥å¦‚ä¸‹ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">title CentOS (2.6.32-279.el6.x86_64)</div><div class="line">        root (hd0,4)</div><div class="line">        kernel /vmlinuz-2.6.32-279.el6.x86_64 ro root=UUID=55151a0d-b460-462b-b5c6-97dfd4a3d328 rd_NO_LUKS  KEYBOARDTYPE=pc KEYTABLE=us rd_NO_MD LANG=zh_CN.UTF-8 rd_NO_LVM rd_NO_DM rhgb quiet nouveau.modeset=0</div><div class="line">        initrd /initramfs-2.6.32-279.el6.x86_64.img</div></pre></td></tr></table></figure><p>ä¿å­˜é€€å‡ºåé‡æ–°å¯åŠ¨ï¼Œå†è¿›å…¥æ–‡æœ¬æ¨¡å¼ã€‚ä½¿ç”¨ä¸‹é¢çš„å‘½ä»¤æ¥æŸ¥çœ‹ä¸€ä¸‹ nouveau æ˜¯å¦æœ‰è¢«åŠ è½½ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">lsmod | grep nouveau</div></pre></td></tr></table></figure><p>å¦‚æœç»“æœä¸ºç©ºï¼Œé‚£åº”è¯¥æ˜¯æˆåŠŸäº†ï¼Œå¯ä»¥æ¥ä¸‹å»è¿›è¡Œé©±åŠ¨çš„å®‰è£…ã€‚é©±åŠ¨çš„å®‰è£…å€’æ˜¯å¾ˆç®€å•ï¼Œæˆ‘å°±ä¸æ‰“ç®—å†™ä¸€éäº†ã€‚è¯¦ç»†çš„å¯ä»¥å‚è€ƒ<a href="http://www.ideasr.com/forum.php?mod=viewthread&amp;tid=7738&amp;extra=page%3D1&amp;page=1" target="_blank" rel="external">è¿™ä¸€ç¯‡æ–‡ç« </a>ã€‚</p><hr><p>æ›´æ–° Ubuntu ä¸‹å®‰è£…æ–¹æ³•ï¼š</p><p>åœ¨ Ubuntu ä¸‹å®‰è£…é©±åŠ¨çš„æ–¹æ³•æ­¥éª¤è¿˜æ˜¯ä¸åœ¨ CentOS ä¸­å·®ä¸å¤šã€‚</p><p>åœ¨å¼•å¯¼ä¸­åŠ å…¥ <code>nouveau.modeset=0</code> ç¦ç”¨ nouveauï¼ˆåŠ ä¸åŠ blacklistå…³ç³»ä¸å¤§ï¼‰ï¼Œç„¶ååœ¨ CLI ç¯å¢ƒä¸‹å®‰è£…é©±åŠ¨ã€‚</p><p>Ubuntu çš„å¼•å¯¼æ–‡ä»¶ä½ç½®ä¸ CentOS å¹¶ä¸ä¸€æ ·ï¼Œå…·ä½“åœ¨å“ªé‡Œæˆ‘ä¹Ÿå¿˜äº†ï¼Œè¯·è‡ªè¡Œæœç´¢è§£å†³å§ã€‚</p><p>ç¦ç”¨ nouveau åï¼Œéœ€è¦è¿›å…¥ CLI ç¯å¢ƒï¼Œä½†æ˜¯ä½¿ç”¨ <code>init 3</code> å‘½ä»¤å¹¶ä¸èƒ½å…³é—­ X Windowï¼Œä¼šå¯¼è‡´å®‰è£…æ— æ³•ç»§ç»­è¿›è¡Œã€‚</p><p>è§£å†³åŠæ³•æ˜¯ä½¿ç”¨ Ctrl+Alt+F1 åˆ‡æ¢åˆ°æ–‡å­—ç•Œé¢ä¸‹ï¼Œç„¶åå°† dm æœåŠ¡åœæ­¢å°±å¯ä»¥å…³é—­ X Windowã€‚Ubuntu çš„é»˜è®¤ dm æ˜¯ lightdmï¼Œå…¶ä»–è¿˜æœ‰ kdmã€gdm ç­‰ï¼Œè¯·æ ¹æ®è‡ªå·±çš„æƒ…å†µæ¥é€‰æ‹©ã€‚</p><p>è¿è¡Œå‘½ä»¤ <code>sudo service lightdm stop</code> æ¥åœæ­¢X Windowã€‚æ¥ä¸‹æ¥å°±å¯ä»¥æŒ‰æµç¨‹å®‰è£…é©±åŠ¨äº†ã€‚</p>]]></content>
      
      
        <tags>
            
            <tag> Linux </tag>
            
        </tags>
      
    </entry>
    
  
  
    
    <entry>
      <title>æ ‡ç­¾</title>
      <link href="/tags/index.html"/>
      <url>/tags/index.html</url>
      <content type="html"><![CDATA[]]></content>
    </entry>
    
  
</search>
